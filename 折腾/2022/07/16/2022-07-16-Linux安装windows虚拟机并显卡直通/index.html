
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
      
      
      
        <link rel="canonical" href="https://yfy.cqu.ai/%E6%8A%98%E8%85%BE/2022/07/16/2022-07-16-Linux%E5%AE%89%E8%A3%85windows%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%B9%B6%E6%98%BE%E5%8D%A1%E7%9B%B4%E9%80%9A/">
      
      
        <link rel="prev" href="../../11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/">
      
      
        <link rel="next" href="../../../../../%E5%8D%9A%E5%AE%A2/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Linux安装windows虚拟机并显卡直通 - Rain的随笔</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#说明" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Rain的随笔" class="md-header__button md-logo" aria-label="Rain的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rain的随笔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Linux安装windows虚拟机并显卡直通
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../series/" class="md-tabs__link">
        
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tools/" class="md-tabs__link">
        
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../archive/2024/" class="md-tabs__link">
          
  
  归档

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../category/homelab/" class="md-tabs__link">
          
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Rain的随笔" class="md-nav__button md-logo" aria-label="Rain的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Rain的随笔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    标签
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../series/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系列
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    归档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    分类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/homelab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    homelab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    个人
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    如何实现网络自由
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%8A%98%E8%85%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    折腾
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%9D%82%E6%96%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    杂文
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%99%9A%E6%8B%9F%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    虚拟化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AE%BE%E5%A4%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设备
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AF%BE%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    阅读
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2022-07-16 00:42:11" class="md-ellipsis">2022年7月16日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../../category/%E6%8A%98%E8%85%BE/">折腾</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 24 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#说明" class="md-nav__link">
    <span class="md-ellipsis">
      说明
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#系统信息" class="md-nav__link">
    <span class="md-ellipsis">
      系统信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="系统信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#华硕b550m主板" class="md-nav__link">
    <span class="md-ellipsis">
      华硕B550m主板
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#基本windows虚拟机" class="md-nav__link">
    <span class="md-ellipsis">
      基本windows虚拟机
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基本windows虚拟机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#通过virt-manger创建虚拟机" class="md-nav__link">
    <span class="md-ellipsis">
      通过virt-manger创建虚拟机
    </span>
  </a>
  
    <nav class="md-nav" aria-label="通过virt-manger创建虚拟机">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#添加磁盘不同方式" class="md-nav__link">
    <span class="md-ellipsis">
      添加磁盘不同方式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#安装qxl驱动" class="md-nav__link">
    <span class="md-ellipsis">
      安装QXL驱动
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#修改为桥接网络" class="md-nav__link">
    <span class="md-ellipsis">
      修改为桥接网络
    </span>
  </a>
  
    <nav class="md-nav" aria-label="修改为桥接网络">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#netplannetworkd创建bridge" class="md-nav__link">
    <span class="md-ellipsis">
      netplan/networkd创建bridge
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networkmanger不推荐" class="md-nav__link">
    <span class="md-ellipsis">
      NetworkManger(不推荐)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virt-manger添加网络" class="md-nav__link">
    <span class="md-ellipsis">
      virt-manger添加网络
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#显卡直通" class="md-nav__link">
    <span class="md-ellipsis">
      显卡直通
    </span>
  </a>
  
    <nav class="md-nav" aria-label="显卡直通">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参考资料" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#步骤总结" class="md-nav__link">
    <span class="md-ellipsis">
      步骤总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#什么是iommu" class="md-nav__link">
    <span class="md-ellipsis">
      什么是IOMMU
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#查看主板iommu组分布" class="md-nav__link">
    <span class="md-ellipsis">
      查看主板iommu组分布
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#一个group里有多个设备怎么办" class="md-nav__link">
    <span class="md-ellipsis">
      一个group里有多个设备怎么办
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#直通slot1或slot2的权衡" class="md-nav__link">
    <span class="md-ellipsis">
      直通slot1或slot2的权衡
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#直通boot-gpu" class="md-nav__link">
    <span class="md-ellipsis">
      直通boot gpu
    </span>
  </a>
  
    <nav class="md-nav" aria-label="直通boot gpu">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#参考资料_1" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法0关闭显示器启动成功" class="md-nav__link">
    <span class="md-ellipsis">
      方法0：关闭显示器启动(成功)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法一csm" class="md-nav__link">
    <span class="md-ellipsis">
      方法一：CSM
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法二efifboff成功" class="md-nav__link">
    <span class="md-ellipsis">
      方法二：efifb:off(成功)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#方法三qemu设置vbios" class="md-nav__link">
    <span class="md-ellipsis">
      方法三：qemu设置vBIOS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="方法三：qemu设置vBIOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dump-vbios" class="md-nav__link">
    <span class="md-ellipsis">
      dump vbios
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#单gpu直通" class="md-nav__link">
    <span class="md-ellipsis">
      单gpu直通?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#遇到的问题" class="md-nav__link">
    <span class="md-ellipsis">
      遇到的问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="遇到的问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rdp很卡" class="md-nav__link">
    <span class="md-ellipsis">
      RDP很卡
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RDP很卡">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vnc与rdp" class="md-nav__link">
    <span class="md-ellipsis">
      VNC与RDP
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parsec连接玩游戏很糊" class="md-nav__link">
    <span class="md-ellipsis">
      parsec连接玩游戏很糊
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steam-link连接时windows用户登录弹窗" class="md-nav__link">
    <span class="md-ellipsis">
      steam link连接时windows用户登录弹窗
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows虚拟机内obs录屏" class="md-nav__link">
    <span class="md-ellipsis">
      Windows虚拟机内OBS录屏
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux启动时黑屏" class="md-nav__link">
    <span class="md-ellipsis">
      Linux启动时黑屏
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#windows启动时循环蓝屏" class="md-nav__link">
    <span class="md-ellipsis">
      Windows启动时循环蓝屏
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Windows启动时循环蓝屏">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#进一步发现" class="md-nav__link">
    <span class="md-ellipsis">
      进一步发现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#解决" class="md-nav__link">
    <span class="md-ellipsis">
      解决
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parsec-报错" class="md-nav__link">
    <span class="md-ellipsis">
      parsec 报错
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#seabios-or-ovmf" class="md-nav__link">
    <span class="md-ellipsis">
      SeaBIOS or OVMF
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#amd-5600xt直通后code43" class="md-nav__link">
    <span class="md-ellipsis">
      AMD 5600XT直通后code43
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#安装nvidia驱动后启动会反复load-nvidia驱动" class="md-nav__link">
    <span class="md-ellipsis">
      安装nvidia驱动后启动会反复load nvidia驱动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1070--1060" class="md-nav__link">
    <span class="md-ellipsis">
      1070 + 1060
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#性能优化" class="md-nav__link">
    <span class="md-ellipsis">
      性能优化
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#其它" class="md-nav__link">
    <span class="md-ellipsis">
      其它
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其它">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-looking-glass-to-stream-guest-screen-to-the-host" class="md-nav__link">
    <span class="md-ellipsis">
      Using Looking Glass to stream guest screen to the host
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#acs-patch" class="md-nav__link">
    <span class="md-ellipsis">
      ACS patch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#附录" class="md-nav__link">
    <span class="md-ellipsis">
      附录
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <a href="../../../../../tags/#gcc" class="md-tag">gcc</a>
    
  
    
    
    
      <a href="../../../../../tags/#mpi" class="md-tag">mpi</a>
    
  
</nav>



  <h1>Linux安装windows虚拟机并显卡直通</h1>

<h2 id="说明">说明<a class="headerlink" href="#说明" title="Permanent link">&para;</a></h2>
<p>在linux上使用KVM安装windows虚拟机。然后将显卡直通(pci passthrough)进虚拟机，从而可以在Windows虚拟机上打游戏。</p>
<p>达到一台机器同时运行两个系统，充分利用硬件。</p>
<!-- more -->

<h2 id="系统信息">系统信息<a class="headerlink" href="#系统信息" title="Permanent link">&para;</a></h2>
<ul>
<li>CPU: AMD Ryzen™ 7 5800X</li>
<li>RAM: Gloway DDR4 2666MHz 32GB</li>
<li>GPU slot1: Zotac GTX 1060 3g</li>
<li>GPU slot2: Yeston RX550 2g</li>
<li>主板：ASUS TUF GAMING B550M-PLUS (WI-FI)</li>
<li>M.2 slot1: Samsung PM9A1 1TB</li>
<li>M.2 slot2: KIOXIA RC10 500GB</li>
<li>SATA: 西数紫盘 2TB</li>
</ul>
<h3 id="华硕b550m主板">华硕B550m主板<a class="headerlink" href="#华硕b550m主板" title="Permanent link">&para;</a></h3>
<p>官方参数：<a href="https://www.asus.com/Motherboards-Components/Motherboards/TUF-Gaming/TUF-GAMING-B550M-PLUS-WI-FI/techspec/">TUF GAMING B550M-PLUS (WI-FI) - Tech Specs｜Motherboards｜ASUS Global</a></p>
<ul>
<li>PCIe slots</li>
<li>来自ryzen 5000 CPU（非G，否则为PCIE 3.0）<ul>
<li>1 x PCIe x16 (4.0x16 mode)</li>
</ul>
</li>
<li>来自B550 chipset<ul>
<li>1 x PCIe x16 (3.0x4 mode)</li>
<li>1 x PCIe x1
  *1 PCIEX16_2 will run x2 mode when PCIEX1 is used.</li>
</ul>
</li>
<li>Storage</li>
<li>2 M.2：CPU(PCIE4.0 x4), PCH(PCIE3.0 x4)</li>
<li>4 SATA 6Gb/s：PCH</li>
</ul>
<h2 id="基本windows虚拟机">基本windows虚拟机<a class="headerlink" href="#基本windows虚拟机" title="Permanent link">&para;</a></h2>
<p>本部分创建一个可用的windows虚拟机，虽然没有显卡，但是也能完成很多事情，比如挂机录屏。</p>
<h3 id="通过virt-manger创建虚拟机">通过virt-manger创建虚拟机<a class="headerlink" href="#通过virt-manger创建虚拟机" title="Permanent link">&para;</a></h3>
<p><strong>libvirt</strong>是一个开源的虚拟机管理API，可以管理KVM, Xen, VMvare, QEMU等虚拟化工具的虚拟机。包含库(libvirt)、命令行工具(virsh)、和virt-manger等GUI工具。参考：https://wiki.libvirt.org/page/FAQ</p>
<p>使用virt-manger创建win10虚拟机，详细步骤参考：<a href="https://getlabsdone.com/install-windows-10-on-ubuntu-kvm/">How To Install Windows 10 on Ubuntu KVM? – Getlabsdone.com</a>。这里就不再详细介绍了，只提一些注意点。</p>
<h4 id="添加磁盘不同方式">添加磁盘不同方式<a class="headerlink" href="#添加磁盘不同方式" title="Permanent link">&para;</a></h4>
<p>添加磁盘有多种方式，不同方式的性能对比：<a href="https://www.youtube.com/watch?v=oSpGggczD2Y">(89) Adding VirtIO and passthrough storage in Virtual Machine Manager - YouTube</a>
- 创建qcow2文件
  - 可以选择virtio, SATA等总线协议。virtio性能最好，但是安装windows时需要额外安装驱动。
- 利用已有磁盘分区，同样可以选择virtio, SATA等总线协议。
- pci直通磁盘</p>
<h4 id="安装qxl驱动">安装QXL驱动<a class="headerlink" href="#安装qxl驱动" title="Permanent link">&para;</a></h4>
<ul>
<li>在安装好windows虚拟机后，运行virtio drivers iso中的<code>virtio-win-guest-tools.exe</code>，该程序会安装其余驱动程序。比较重要的是QXL显示适配器驱动，该驱动会使得显示更加流畅</li>
</ul>
<p>此时windows虚拟机已经可以使用了。但是创建虚拟机时，默认会使用默认的网桥<code>virbr0</code>，而它是NAT的，有自己的地址段。因此host可以访问虚拟机，但是从host外无法访问虚拟机。</p>
<p>为了让其它设备也能自由访问虚拟机，需要设置下面要介绍的虚拟网桥</p>
<h3 id="修改为桥接网络">修改为桥接网络<a class="headerlink" href="#修改为桥接网络" title="Permanent link">&para;</a></h3>
<p>使用docker、lxc、libvirt时，都会创建默认的bridge设备，如virbr0便是libvirt创建的。
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>➜<span class="w">  </span>~<span class="w"> </span>brctl<span class="w"> </span>show
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>bridge<span class="w"> </span>name<span class="w">     </span>bridge<span class="w"> </span>id<span class="w">               </span>STP<span class="w"> </span>enabled<span class="w">     </span>interfaces
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>br-d1cfd67efd10<span class="w">         </span><span class="m">8000</span>.0242abdcc8f5<span class="w">       </span>no<span class="w">              </span>veth461ccef
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>br0<span class="w">             </span><span class="m">8000</span>.be316828842b<span class="w">       </span>yes<span class="w">             </span>enp7s0
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">                                                        </span>vnet1
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>docker0<span class="w">         </span><span class="m">8000</span>.0242ff18344e<span class="w">       </span>no<span class="w">              </span>veth2305c74
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">                                                        </span>veth69f27d6
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>lxdbr0<span class="w">          </span><span class="m">8000</span>.00163ecbf2fc<span class="w">       </span>no
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>virbr0<span class="w">          </span><span class="m">8000</span>.525400bf6a2c<span class="w">       </span>yes<span class="w">             </span>vnet0
</span></code></pre></div></p>
<p>libvirt创建不同类型网络参考：<a href="https://wiki.libvirt.org/page/Networking">Networking - Libvirt Wiki</a>
- nat：虚拟机位于一个虚拟的网段，通过nat到宿主机上网。libvirt默认提供一个叫做<code>default</code>的网络
- bridge：虚拟机和物理机共享网络。</p>
<p>虚拟机想要使用bridge模式来说，分为两步
- 在linux中创建bridge设备
- virt-manger中创建网络，使用该bridge设备</p>
<h4 id="netplannetworkd创建bridge">netplan/networkd创建bridge<a class="headerlink" href="#netplannetworkd创建bridge" title="Permanent link">&para;</a></h4>
<p>ubuntu20.04起使用netplan管理网络，桌面版的render使用NetworkManger，服务器版则使用networkd。
- NetworkManger用于图形化界面管理网络
- networkd使用配置文件管理
对于复杂的网络来说，还是networkd更合适。</p>
<p><em>ps. 还有其它方式，如使用iproute2/ip, bridge-utils/brctl创建bridge，参考：<a href="https://wiki.archlinux.org/title/network_bridge">Network bridge - ArchWiki (archlinux.org)</a></em></p>
<ul>
<li>关闭NetworkManger，启动networkd
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>sudo systemctl stop NetworkManager
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>sudo systemctl disable NetworkManager
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>sudo systemctl enable systemd-networkd
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>sudo systemctl start systemd-networkd
</span></code></pre></div></li>
<li>编辑配置文件</li>
<li>eth0改为实际网卡名字，pcie网卡前缀一般为enp</li>
<li>其中eth0 dchp4 false表示该接口上不会尝试去dhcp请求ip地址。要想访问host，需要通过br0的ip地址
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cd /etc/netplan/
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a># 备份原本的配置
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>mv 01-xxx.yaml 01-xxx.yaml.bak
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a># 新建配置
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>vim 10-yyy.yaml
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>network:
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>  version: 2
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>  renderer: networkd
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>  ethernets:
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    eth0:
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>      dhcp4: false
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>      dhcp6: false
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>  bridges:
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    br0:
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>      dhcp4: true
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>      dhcp6: true
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>      interfaces:
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a>        - eth0
</span></code></pre></div></li>
<li>应用`netplan apply </li>
</ul>
<h4 id="networkmanger不推荐">NetworkManger(不推荐)<a class="headerlink" href="#networkmanger不推荐" title="Permanent link">&para;</a></h4>
<p>ubuntu20.04使用netplan管理网络，其中桌面版render使用NetworkManger，一些教程使用/etc/network/interfaces创建bridge设备已经不适用了。</p>
<p>使用NetworkManger创建bridge参考：<a href="https://www.cyberciti.biz/faq/how-to-add-network-bridge-with-nmcli-networkmanager-on-linux/">How to add network bridge with nmcli (NetworkManager) on Linux - nixCraft (cyberciti.biz)</a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>nmcli<span class="w"> </span>con<span class="w"> </span>add<span class="w"> </span>ifname<span class="w"> </span>br0<span class="w"> </span><span class="nb">type</span><span class="w"> </span>bridge<span class="w"> </span>con-name<span class="w"> </span>br0
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>nmcli<span class="w"> </span>con<span class="w"> </span>add<span class="w"> </span><span class="nb">type</span><span class="w"> </span>bridge-slave<span class="w"> </span>ifname<span class="w"> </span>enp7s0<span class="w"> </span>master<span class="w"> </span>br0
</span></code></pre></div>
<p><strong>注意点</strong>
- 启用了bridge设备时，需要关闭原有以太网设备。之后访问机器得通过br0。
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>down<span class="w"> </span><span class="s2">&quot;Wired connection 1&quot;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>sudo<span class="w"> </span>nmcli<span class="w"> </span>con<span class="w"> </span>up<span class="w"> </span>br0
</span></code></pre></div>
  - ssh连接时会导致连接断开，因此需要用脚本执行上面两条命令。
  - 新启用的br0会拥有LAN的ip地址，但是地址相较于原本地址会发生改变。可以在路由器中看到新的ip地址，然后ssh连接 
    - 或者使用wifi维持另一个网络连接
- 无法在wifi设备上创建bridge，只能是有线以太网。</p>
<h4 id="virt-manger添加网络">virt-manger添加网络<a class="headerlink" href="#virt-manger添加网络" title="Permanent link">&para;</a></h4>
<p>virt-manger中，在编辑-&gt;连接详情-&gt;虚拟网络添加一个网络
<div class="language-xml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nt">&lt;network&gt;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">  </span><span class="nt">&lt;name&gt;</span>br0<span class="nt">&lt;/name&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">&lt;forward</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;bridge&quot;</span><span class="nt">/&gt;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">  </span><span class="nt">&lt;bridge</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;br0&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="nt">&lt;/network&gt;</span>
</span></code></pre></div></p>
<h2 id="显卡直通">显卡直通<a class="headerlink" href="#显卡直通" title="Permanent link">&para;</a></h2>
<h3 id="参考资料">参考资料<a class="headerlink" href="#参考资料" title="Permanent link">&para;</a></h3>
<ul>
<li>最完整的Arch wiki：<a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF">PCI passthrough via OVMF - ArchWiki (archlinux.org)</a></li>
<li>KVM创建虚拟机并显卡直通详细博客：<a href="https://www.heiko-sieger.info/creating-a-windows-10-vm-on-the-amd-ryzen-9-3900x-using-qemu-4-0-and-vga-passthrough/">Creating a Windows 10 kvm VM on the AMD Ryzen 9 3900X using VGA Passthrough - Heiko's Blog % Virtualization (heiko-sieger.info)</a></li>
<li>帮助我解决了windows蓝屏问题的博客：<a href="https://blog.twenska.de/blog/GPU_passthrough/">GPU passthrough - my switch to Linux - twenska is writing…</a></li>
<li>比较好的github page：<a href="https://clayfreeman.github.io/gpu-passthrough/">GPU Passthrough on GNU/Linux | gpu-passthrough (clayfreeman.github.io)</a></li>
</ul>
<p>PVE资料
- https://pve.proxmox.com/wiki/PCI_Passthrough
- <a href="https://www.spice-space.org/download.html#windows-binaries">Download (spice-space.org)</a>
- AMD 5000XT, 6000XT, reset bug: <a href="https://github.com/gnif/vendor-reset">gnif/vendor-reset: Linux kernel vendor specific hardware reset module for sequences that are too complex/complicated to land in pci_quirks.c (github.com)</a></p>
<h3 id="步骤总结">步骤总结<a class="headerlink" href="#步骤总结" title="Permanent link">&para;</a></h3>
<p>对于可热插拔的设备，在virt-manger中添加需要直通的host pci设备即可（可热插拔的设备，虚拟机启动时vfio_pci接管设备驱动，关闭虚拟机时，host可重新访问），但是对于显卡这种无法热插拔的设备，则较为复杂：
- 需要通过lspci命令，查看pci设备的总线地址，设备id，以及所处的IOMMU group
- 如果显卡单独位于一个IOMMU group，则可以直通，可以进行之后步骤
  - 否则，尝试移动显卡位置（另一个pciex16的槽），看是否为单独group
  - 不行的话需要尝试ACS patch（见后），可能导致不稳定</p>
<p>确定可以直通后步骤：
- bios开启<strong>虚拟化</strong>(intel: vt-x, AMD: SVM)和<strong>iommu</strong>(intel: vt-d, AMD: AMD-Vi)支持
  - 以我的AMD平台为例，需要开启SVM，IOMMU，ACS（位于AMD CBS中，BIOS中搜索关键词即可）
- virt-manger中添加pci设备，选择显卡group下的所有设备（通常另一个为声卡）
- grub修改内核启动参数（grub2通过编辑/etc/default/grub，然后sudo update-grub）
  - 开启iommu
  - 在启动时将显卡绑定到vifo_pci驱动上（还有相同group下的声卡）
  - 最终我的启动参数示例
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nv">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;quiet splash amd_iommu=on vfio_pci.ids=10de:1d01,10de:0fb8 kvm.ignore_msrs=1&quot;</span>
</span></code></pre></div></p>
<ul>
<li>显卡处于虚拟化环境中会拒绝工作，需要在virt-manger XML中添加额外参数。参考<a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Video_card_driver_virtualisation_detection">archiwiki</a></li>
<li>vendor_id：对于Nvidia的显卡，会报43错误。在早期的驱动需要下面的vendor_id，<em>但是最新的显卡驱动已经不需要了</em>。在windows内更新显卡驱动便会正常工作。</li>
<li>hidden：让显卡不知道位于虚拟机中（windows还是知道的）
  <div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>&lt;features&gt;
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  ...
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  &lt;hyperv&gt;
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    ...
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    &lt;vendor_id state=&#39;on&#39; value=&#39;randomid&#39;/&gt;
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    ...
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>  &lt;/hyperv&gt;
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  &lt;kvm&gt;
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    &lt;hidden state=&#39;on&#39;/&gt;
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>  &lt;/kvm&gt;
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>  ...
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>&lt;/features&gt;
</span></code></pre></div></li>
</ul>
<h3 id="什么是iommu">什么是IOMMU<a class="headerlink" href="#什么是iommu" title="Permanent link">&para;</a></h3>
<p>关于IOMMU和ACS：<a href="https://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html"></a></p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/MMU_and_IOMMU.svg/564px-MMU_and_IOMMU.svg.png" alt="img" style="zoom:50%;" /></p>
<ul>
<li>PCIE支持requst id，因此可以识别不同设备，每个设备可以使用自己的虚拟地址空间(I/O virtual address, IOVA)，IOMMU负责转换</li>
<li>然后设备之间还可以通过DMA直接peer to peer通信，这些通信不经过IOMMU，因此可能导致问题，比如网卡的DMA请求发送到了磁盘。PCIe Access Control Services (ACS) 便用于解决这个问题。它使我们能够知道设备间是否能够直接通信以及是否能够关闭。</li>
<li>对于不支持ACS的设备，IOMMU将其归为一个group。</li>
<li>PCI直通必须直通一个IOMMU group的所有设备（除掉特殊的PCI root设备）</li>
</ul>
<p>PCIe连接的通道由CPU或者主板芯片组（以前的南北桥）提供。是否支持ACS和CPU有关</p>
<blockquote>
<p>On a typical Intel chipset, PCIe root ports are provided via both the processor and the PCH (Platform Controller Hub).  The capabilities of these root ports can be very different.  On the latest Linux kernels we have support for exposing the isolation of the PCH root ports, even though many of them do not have native PCIe ACS support.
On Xeon class processors (<a href="http://www.intel.com/content/dam/www/public/us/en/documents/specification-updates/xeon-e3-1200v3-spec-update.pdf">except E3-1200 series</a>), the processor-based PCIe root ports typically support ACS.  Client processors, such as the i5/i7 Core processor do not support ACS, but we can hope future products from Intel will update this support.</p>
<p>You cannot change the IOMMU groups. It is determined by the motherboard and the BIOS. You can put it in different slots and see if that helps. You can try different BIOS versions, or buy a X570 motherboard. And you can use the pcie_acs_override if you don't care about the device isolation, which means that the device passed through to the VM can still talk to the host and/or devices in other VMs.</p>
</blockquote>
<h3 id="查看主板iommu组分布">查看主板iommu组分布<a class="headerlink" href="#查看主板iommu组分布" title="Permanent link">&para;</a></h3>
<p>使用下面脚本，得到主板上iommu组的信息
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nb">shopt</span><span class="w"> </span>-s<span class="w"> </span>nullglob
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="k">for</span><span class="w"> </span>g<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>find<span class="w"> </span>/sys/kernel/iommu_groups/*<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">0</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-V<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;IOMMU Group </span><span class="si">${</span><span class="nv">g</span><span class="p">##*/</span><span class="si">}</span><span class="s2">:&quot;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span>d<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$g</span>/devices/*<span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">        </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\t</span><span class="k">$(</span>lspci<span class="w"> </span>-nns<span class="w"> </span><span class="si">${</span><span class="nv">d</span><span class="p">##*/</span><span class="si">}</span><span class="k">)</span><span class="s2">&quot;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="k">done</span><span class="p">;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="k">done</span><span class="p">;</span>
</span></code></pre></div></p>
<p><strong>我的IOMMU分布</strong>
可知：
- 靠近CPU一侧的nvme插槽（PCIE 4.0 x 4）位于单独的14号组（CPU通道）
- 位于靠近CPU的一侧的显卡插槽（PCIE 4.0 x16）位于单独的16号组（CPU通道）
- 其余：显卡插槽2（PCIE 3.0 x4）、nvme插槽（PCIE 3.0 x 4）、以太网卡、wifi6无线网卡和SATA控制器、USB控制器均位于15号组（主板通道）</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Please be patient. This may take a couple seconds.
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>Group:  0   0000:00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>Group:  1   0000:00:01.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>Group:  2   0000:00:01.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>Group:  3   0000:00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>Group:  4   0000:00:03.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>Group:  5   0000:00:03.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>Group:  6   0000:00:04.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>Group:  7   0000:00:05.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>Group:  8   0000:00:07.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>Group:  9   0000:00:07.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>Group:  10  0000:00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>Group:  11  0000:00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>Group:  12  0000:00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:790b] (rev 61)   Driver: piix4_smbus
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>Group:  12  0000:00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:790e] (rev 51)
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>Group:  13  0000:00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 0 [1022:1440]
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>Group:  13  0000:00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 1 [1022:1441]
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>Group:  13  0000:00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 2 [1022:1442]
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>Group:  13  0000:00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 3 [1022:1443]   Driver: k10temp
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>Group:  13  0000:00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 4 [1022:1444]
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>Group:  13  0000:00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 5 [1022:1445]
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>Group:  13  0000:00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 6 [1022:1446]
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>Group:  13  0000:00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 7 [1022:1447]
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>Group:  14  0000:01:00.0 Non-Volatile memory controller [0108]: Samsung Electronics Co Ltd NVMe SSD Controller PM9A1/PM9A3/980PRO [144d:a80a]   Driver: nvme
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>Group:  15  0000:02:00.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ee]   Driver: xhci_hcd
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>Group:  15  0000:02:00.1 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD] Device [1022:43eb]   Driver: ahci
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>Group:  15  0000:02:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43e9]   Driver: pcieport
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>Group:  15  0000:03:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>Group:  15  0000:03:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>Group:  15  0000:03:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>Group:  15  0000:03:09.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>Group:  15  0000:04:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin [Radeon RX 550 640SP / RX 560/560X] [1002:67ff] (rev ff)   Driver: amdgpu
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>Group:  15  0000:04:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X] [1002:aae0]   Driver: snd_hda_intel
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>Group:  15  0000:05:00.0 Non-Volatile memory controller [0108]: KIOXIA Corporation NVMe SSD [1e0f:0009] (rev 01)   Driver: nvme
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>Group:  15  0000:06:00.0 Network controller [0280]: Intel Corporation Wi-Fi 6 AX200 [8086:2723] (rev 1a)   Driver: iwlwifi
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>Group:  15  0000:07:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller [10ec:8125] (rev 05)   Driver: r8169
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>Group:  16  0000:08:00.0 VGA compatible controller [0300]: NVIDIA Corporation GP106 [GeForce GTX 1060 3GB] [10de:1c02] (rev a1)   Driver: vfio-pci
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>Group:  16  0000:08:00.1 Audio device [0403]: NVIDIA Corporation GP106 High Definition Audio Controller [10de:10f1] (rev a1)   Driver: vfio-pci
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>Group:  17  0000:09:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Function [1022:148a]
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>Group:  18  0000:0a:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Reserved SPP [1022:1485]
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>Group:  19  0000:0a:00.1 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Cryptographic Coprocessor PSPCPP [1022:1486]   Driver: ccp
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a>Group:  20  0000:0a:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Matisse USB 3.0 Host Controller [1022:149c]   Driver: xhci_hcd
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a>Group:  21  0000:0a:00.4 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse HD Audio Controller [1022:1487]   Driver: snd_hda_intel
</span></code></pre></div>
<h3 id="一个group里有多个设备怎么办">一个group里有多个设备怎么办<a class="headerlink" href="#一个group里有多个设备怎么办" title="Permanent link">&para;</a></h3>
<p>主板上的不同PCIe slot可以连接到CPU上或者PCH(主板芯片组)上。我的主板貌似将所有设备都放入了一个group。因此我的显卡2和nvme固态盘等设备都无法直通。</p>
<p>对于一个组里有很多设备有一些解决方法：<a href="https://www.heiko-sieger.info/iommu-groups-what-you-need-to-consider/">IOMMU Groups - What You Need to Consider - Heiko's Blog - VFIO (heiko-sieger.info)</a>
- 更新内核版本，新的内核版本可能对主板支持的更好，IOMMU group会改变
- 移动设备位置
- 安装kernel patch：https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Bypassing_the_IOMMU_groups_(ACS_override_patch)</p>
<p>但是我目前就选择直通slot 1显卡算了。</p>
<h3 id="直通slot1或slot2的权衡">直通slot1或slot2的权衡<a class="headerlink" href="#直通slot1或slot2的权衡" title="Permanent link">&para;</a></h3>
<p>直通slot1
- slot1显卡的风扇会被slot2显卡的PCB版挡住，散热不太好
  - 解决方法：使用PCIE显卡延长线（但是x16的太贵了，90RMB）
- boot gpu默认为slot 1的问题。BIOS无法设置primary display，导致windows虚拟机会蓝屏(<a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Passing_the_boot_GPU_to_the_guest">PCI passthrough via OVMF - Passing_the_boot_GPU_to_the_guest</a>
  - 该问题已解决
直通slot2
- slot2和主板上的其它设备位于一组，无法直通slot2
  - 使用ACS patch
- 我B550的主板，slot2的虽然是x16长度的，但是只有x4 PCIE 3.0的带宽，显卡一般最少需要x8 PCIE 3.0，否则会对性能有影响，甚至无法工作
  - 一般来说双显卡时，两个槽应该都是工作在x8的模式下的吧。为何我的主板不支持将slot1的lane分给slot2呢？</p>
<h3 id="直通boot-gpu">直通boot gpu<a class="headerlink" href="#直通boot-gpu" title="Permanent link">&para;</a></h3>
<p>如直通AMD 6500xt时遇到的问题所描述的。直通boot gpu存在一些问题。这里是对该问题的进一步总结</p>
<h4 id="参考资料_1">参考资料<a class="headerlink" href="#参考资料_1" title="Permanent link">&para;</a></h4>
<ul>
<li>问题相关讨论：<a href="https://forum.level1techs.com/t/gpu-assistance-select-boot-gpu/151745/6">GPU Assistance - Select boot GPU - Software &amp; Operating Systems / VFIO - Level1Techs Forums</a></li>
<li>要么bios支持选择primary gpu</li>
<li>要么swap gpu slot</li>
<li>解释问题原理，以及解决：<a href="https://passthroughpo.st/explaining-csm-efifboff-setting-boot-gpu-manually/">Explaining CSM, efifb=off, and Setting the Boot GPU Manually - The Passthrough POST</a></li>
</ul>
<p>是否需要dump vbios：<a href="https://www.reddit.com/r/VFIO/comments/uyyb15/when_is_a_gpu_rom_required_and_how_does_it_get/">(8) When is a GPU ROM required and how does it get used? : VFIO (reddit.com)</a>
- 最详细解释： <a href="https://www.reddit.com/r/VFIO/comments/t35oji/comment/hyqus40/">(8) Do you need or not need a vbios file? : VFIO (reddit.com)</a></p>
<blockquote>
<p>For some graphics cards or other PCI-e devices, this step may be unnecessary. Some GPUs can operate just fine without mapping a static ROM file; the virtual machine can just directly access the device ROM. Your results may vary, though. The primary purpose of this step is to ensure that successive virtual machine reboots won’t require the hypervisor to be rebooted to reset the GPU’s ROM to an uninitialized state.</p>
</blockquote>
<p>问题原因
- uefi是电脑启动后cpu最早运行的代码
- uefi需要初始化primary gpu，因为需要设置菜单。This is because UEFI setup menus, along with boot splash screens, must work in a generic way, as UEFI cannot possibly include a driver for every possible GPU.
- UEFI初始化后，暴露给linux的是修改后的vBIOS (shadow copy)。If the host UEFI already initialized the device, the host UEFI makes a “shadow” copy of the GPU’s vBIOS on startup, and that is what Linux exposes as the device’s vBIOS.
- guest也有自己的UEFI（开源的OVMF），也需要初始化设备。而host暴露给guest的是shadow copy，故冲突。OVMF usually hangs at this stage.</p>
<p>解决办法</p>
<h4 id="方法0关闭显示器启动成功">方法0：关闭显示器启动(成功)<a class="headerlink" href="#方法0关闭显示器启动成功" title="Permanent link">&para;</a></h4>
<p>关闭primary gpu的显示器，second gpu插上hdmi欺骗器（不插的话相当于没有显示器，启动时自检，显卡亮白灯？）</p>
<p>但是发现dell的显示器关闭开关后，仍然能识别到？需要彻底拔下来才行</p>
<h4 id="方法一csm">方法一：CSM<a class="headerlink" href="#方法一csm" title="Permanent link">&para;</a></h4>
<p>UEFI开启CSM。让UEFI初始化另一个GPU。<a href="https://zhuanlan.zhihu.com/p/36530184">关于CSM和UEFI你要知道的一些事 - 知乎 (zhihu.com)</a></p>
<p>试过后对我没有作用</p>
<p><a href="https://www.reddit.com/r/VFIO/comments/hwro4x/passing_through_custom_rom_file_doesnt_change/">(8) Passing through custom ROM file doesn't change anything : VFIO (reddit.com)</a></p>
<blockquote>
<p>If you're using an MSI x370 Pro like I was, there isn't actually a setting for this. The solution is to install linux in UEFI mode and enable Windows 10 WHOQL Support (even though you're booting to Linux). This is a hackish solution that causes the board to use a second GPU instead of the GPU in the primary slot.</p>
</blockquote>
<p>类似于下面要说的efifb:off</p>
<blockquote>
<p>I've got 2 graphics cards, a 2070 and a 1080. The 2070 I'm using as pass-through, the 1080 is the one I'm using for basic Linux stuff.
On boot, the 2070 is initialised as the primary display by the MB and since <strong>I've blacklisted it from grub it basically only displays the Linux kernel version and nothing else.</strong> Then, rest of the startup is (effectively) silent, until Linux starts X, which then uses the 1080 as it's display since that's what I've configured it to use.</p>
</blockquote>
<h4 id="方法二efifboff成功">方法二：efifb:off(成功)<a class="headerlink" href="#方法二efifboff成功" title="Permanent link">&para;</a></h4>
<p>保证boot时，不使用primary GPU。
- linux启动时会显示启动日志和tty login到终端中(console)。在linux桌面发行版中，console被输出到framebuffer中。
- 显卡驱动和EFI/BIOS能够提供这个framebuffer
- 在linux启动的早期（还没有加载显卡驱动之前），使用EFI/VESA提供的framebuffer。而这便会使用firmware指定的primary gpu。</p>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>video=efifb:off
</span></code></pre></div>
相当于禁用了tty？</p>
<p>重新测试
两张显卡都连接显示器，主显卡直通。
- 默认情况下，boot logo显示在primary上，画面没有问题。启动完成后主显示器显示login shell。启动vm，黑屏，远程连接显示43错误。
- 主显卡不连接显示器，boot logo显示在second上，画面颜色不对，ubuntu logo缺少东西。启动vm没问题
- 开启efifb:off，刚开始主显示器上显示选择是否进bios画面，接着主显示器熄灭。副显示器只显示了logo，F2黑屏（没有log输出）。最后进入了系统（没有login shell）。启动vm没有问题。</p>
<h4 id="方法三qemu设置vbios">方法三：qemu设置vBIOS<a class="headerlink" href="#方法三qemu设置vbios" title="Permanent link">&para;</a></h4>
<p>QEMU can expose the vBIOS from a ROM file supplied to it by libvirt.
获得vBIOS方法
- dump，见结尾 dump bios
- 从网络上下载（TechPowerup）
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>&lt;hostdev mode=&#39;subsystem&#39; type=&#39;pci&#39; managed=&#39;yes&#39;&gt;
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a> &lt;source&gt;
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a> &lt;address domain=&#39;0x0000&#39; bus=&#39;0x01&#39; slot=&#39;0x00&#39; function=&#39;0x0&#39;/&gt;
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a> &lt;/source&gt;
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a> &lt;rom file=&#39;/path/to/vbios.rom&#39;/&gt;
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a> &lt;address type=&#39;pci&#39; domain=&#39;0x0000&#39; bus=&#39;0x00&#39; slot=&#39;0x04&#39; function=&#39;0x0&#39;/&gt;
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>&lt;/hostdev&gt;
</span></code></pre></div></p>
<p>试过后报错
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>➜  ~ sudo virsh start win10
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>error: Failed to start domain &#39;win10&#39;
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>error: internal error: qemu unexpectedly closed the monitor: 2023-05-25T06:28:54.441761Z qemu-system-x86_64: warning: This family of AMD CPU doesn&#39;t support hyperthreading(2)
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>Please configure -smp options properly or try enabling topoext feature.
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>2023-05-25T06:28:55.270270Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: vfio_listener_region_add received unaligned region
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>2023-05-25T06:29:00.830154Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: Failed to mmap 0000:0a:00.0 BAR 0. Performance may be slow
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>2023-05-25T06:29:00.875494Z qemu-system-x86_64: -device vfio-pci,host=0000:0a:00.0,id=hostdev3,bus=pci.5,addr=0x0,romfile=/home/yfy/scripts/data/vbios-amd-6500xt.bin: failed to find romfile &quot;/home/yfy/scripts/data/vbios-amd-6500xt.bin&quot;
</span></code></pre></div></p>
<p>发现
- 只有开启vm后，才可以dump bios，否者会报output error
- 关闭屏幕下开机t，vm显卡正常。但是dump的vbios通不过检验。反而是打开屏幕下开机，vm显卡不正常的可以通过检验。
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>Valid ROM signature found @0h, PCIR offset 370h
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>        PCIR: type 0 (x86 PC-AT), vendor: 1002, device: 743f, class: 030000
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>        PCIR: revision 0, vendor revision: 1404
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>Error, ran off the end
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>Valid ROM signature found @0h, PCIR offset 370h
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>        PCIR: type 0 (x86 PC-AT), vendor: 1002, device: 743f, class: 030000
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>        PCIR: revision 0, vendor revision: 1404
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>Valid ROM signature found @ae00h, PCIR offset 1ch
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>        PCIR: type 3 (EFI), vendor: 1002, device: 743f, class: 030000
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>        PCIR: revision 0, vendor revision: 0
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>                EFI: Signature Valid, Subsystem: Boot, Machine: X64
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>Valid ROM signature found @14400h, PCIR offset 1ch
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>        PCIR: type 3 (EFI), vendor: 1002, device: 743f, class: 000000
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>        PCIR: revision 0, vendor revision: 0
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>                EFI: Signature Valid, Subsystem: Boot, Machine: ARM 64-bit
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>        Last image
</span></code></pre></div></p>
<p><a href="https://www.reddit.com/r/VFIO/comments/t35oji/comment/hyqus40/">(8) Do you need or not need a vbios file? : VFIO (reddit.com)</a>
使用错误的vbios不会对显卡造成损坏
OR, you can use vbios dumps from other people on the Internet. It's less wise, but in some intentional personal testing I was unable to kill my nvidia GPU's by initializing them on my VM with intentionally bad/truncated/wrong-version romfile=xxx roms. In fact some of those worked for my single GPU passthrough scenarios on GTX780's and a 2080Ti despite being vastly different versions than my GPU's actual current vbios version. Minor differences I presume.</p>
<p>和实际flash gpu rom是不同的
I personally wouldn't advise actually flashing your GPU's bios unless required. From what I can see, that is not the same thing as the vbios romfile= qemu option where you're asking your guest to execute a fake rom as a one-off from your host instead of the broken (or valid if correctly isolated) boot rom data on your GPU as it were already initialized by the host earlier in the boot.</p>
<p>nv的有rom只能运行一次的问题，amd没有
Furthermore, it seems only NVIDIA cards have this problem and even then only some. They can be initialized once per boot. That's it. AMD cards don't seem to have this problem AFAIK and present their rom the same all the time, so the VM has no trouble initializing them again and again and again once given one.</p>
<p>什么使用需要指定bios
This means that if your motherboard draws to the GPU on boot with system information, a logo and what not on the GPU you want to pass through then you're already too late and would need a vbios file if you cannot stop this behavior in your host's bios settings.</p>
<p>If your motherboard doesn't have an option to strictly pick which GPU to use (integrated vs dedicated, or an option of <em>which</em> of multiple dedicated to use) it may initialize it too and you will need a vbios file for a guest all the same.</p>
<p>Single GPU hosts don't get any choice and have to draw their POST information ...somewhere... So you will almost always need a vbios file outside very special motherboard configurations (Usually Server boards handle this nicely, even if they only have a shitty onboard 8MB vga plug for basic terminal display only)</p>
<blockquote>
<p>Basically if the host uses the card at all, it's initialized and the rom is borked for the boot. A vbios file will be needed for a guest to reinitialize it and works around this nicely.</p>
</blockquote>
<p>可以动态直通显卡？
I personally don't think about it too much. I've written my <a href="https://github.com/ipaqmaster/vfio">own vfio script</a> compatible with my single GPU host and use a vbios file and use my linux desktop for as long as I like until I want to pass the gpu to the guest, it dynamically unbinds the nvidia driver and stops lightdm before starting the guest with the vbios romfile included to reinitialize the card.</p>
<p>不关机重置gpu？
This makes me imagine that putting a PC to sleep then waking it as you start your qemu VM may be another way to 'reboot' the GPU and restore its vbios rom ready for the guest without a true host reboot (With a low enough sleep state), but who wants to do that. Maybe something for me to experiment with though. It could also help make the GPU more stable when returning to a host in some circumstances.</p>
<h5 id="dump-vbios">dump vbios<a class="headerlink" href="#dump-vbios" title="Permanent link">&para;</a></h5>
<p><a href="https://github.com/SpaceinvaderOne/Dump_GPU_vBIOS/blob/master/dump_vbios.sh">Dump_GPU_vBIOS/dump_vbios.sh at master · SpaceinvaderOne/Dump_GPU_vBIOS (github.com)</a>
<a href="https://www.reddit.com/r/VFIO/comments/ma0s7j/how_to_dump_gpu_vbios_on_linux/">(8) How to dump GPU VBIOS on linux? : VFIO (reddit.com)</a>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>cd /sys/bus/pci/devices/0000:0a:00.0
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>echo 1 &gt; rom
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>cat rom &gt; /tmp/vbios
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>echo 0 &gt; rom
</span></code></pre></div></p>
<h3 id="单gpu直通">单gpu直通?<a class="headerlink" href="#单gpu直通" title="Permanent link">&para;</a></h3>
<p><a href="https://www.reddit.com/r/VFIO/comments/mrlhva/single_nvidia_passthrough_endless_kernel_nvrm_logs/">(8) Single Nvidia passthrough: endless kernel NVRM logs : VFIO (reddit.com)</a></p>
<h2 id="遇到的问题">遇到的问题<a class="headerlink" href="#遇到的问题" title="Permanent link">&para;</a></h2>
<h3 id="rdp很卡">RDP很卡<a class="headerlink" href="#rdp很卡" title="Permanent link">&para;</a></h3>
<p>发现设备管理器中显示的是Microsoft基本显示适配器，在显示适配器上手动安装QXL驱动后解决（位于virtio光盘的qxlod目录下）</p>
<h4 id="vnc与rdp">VNC与RDP<a class="headerlink" href="#vnc与rdp" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>远程桌面RDP使用自己的remote display显示适配器，和一个通用非即插即用设备(uPnP)</p>
</li>
<li>
<p>tightvnc则会使用QXL controller + PnP</p>
</li>
</ul>
<p><img alt="image-20220718124846271" src="https://raw.githubusercontent.com/TheRainstorm/.image-bed/main/picgo/image-20220718124846271.png" /></p>
<ul>
<li>后面发现貌似tightvnc和parsec远程连接（使用虚拟显示适配器）和VNC（使用显卡或者QXL）都会使用，优先VNC。</li>
</ul>
<h4 id="parsec连接玩游戏很糊">parsec连接玩游戏很糊<a class="headerlink" href="#parsec连接玩游戏很糊" title="Permanent link">&para;</a></h4>
<p>发现是显示器选择了125%的缩放导致的</p>
<h3 id="steam-link连接时windows用户登录弹窗">steam link连接时windows用户登录弹窗<a class="headerlink" href="#steam-link连接时windows用户登录弹窗" title="Permanent link">&para;</a></h3>
<p>参考：<a href="https://steamcommunity.com/groups/homestream/discussions/0/1696049513769785227/">Can't get past Steam Input Dialog Box :: Steam Remote Play (steamcommunity.com)</a></p>
<p>问题为使用steam link连接时，windows需要登录。但是会弹出一个窗口，说：Would you like to accept secure desktop input from Steam? steam link远程登陆时无法点击系统弹窗，导致无法进入。弹窗也说需要坐在电脑前点击确认</p>
<p>解决：如果windows没有锁屏，那么steam link登录就不需要输入密码登录windows。可以在windows上安装tightvnc，通过vnc连接后，steam link连接时就不会输密码了（而且vnc连接也不会掉）</p>
<h3 id="windows虚拟机内obs录屏">Windows虚拟机内OBS录屏<a class="headerlink" href="#windows虚拟机内obs录屏" title="Permanent link">&para;</a></h3>
<p>通过rdp远程连接windows时使用OBS录屏，会发现断开rdp连接后，录到的是黑屏。原因是rdp连接时，使用的是虚拟的显示适配器（因此无法调节分辨率），虚拟的声卡。当断开连接时，这些都会消失，故无法录屏。</p>
<p>解决办法为使用vnc，vnc连接后开启录屏，断开连接后，仍然在录屏。</p>
<h3 id="linux启动时黑屏">Linux启动时黑屏<a class="headerlink" href="#linux启动时黑屏" title="Permanent link">&para;</a></h3>
<p>由于host gpu处于第二个槽，导致X启动失败</p>
<p>https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#X_does_not_start_after_enabling_vfio_pci</p>
<p>这里也提到了</p>
<p>https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Host_unable_to_boot_and_stuck_in_black_screen_after_enabling_vfio</p>
<p>解决</p>
<ul>
<li>kernel cmd
  <div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>video_vifib=off
</span></code></pre></div></li>
<li>xorg
  <div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>/etc/X11/xorg.conf.d/second_gpu.conf
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>Section &quot;Device&quot;
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        Identifier &quot;AMD GPU&quot;
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>        Driver &quot;amdgpu&quot;       #填lspci看到的驱动
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>        BusID  &quot;PCI:4:0:0&quot;    #bus id, device id, function id
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>EndSection
</span></code></pre></div></li>
</ul>
<h3 id="windows启动时循环蓝屏">Windows启动时循环蓝屏<a class="headerlink" href="#windows启动时循环蓝屏" title="Permanent link">&para;</a></h3>
<p>windows启动时蓝屏，蓝屏两次后进入恢复界面，选择关机后再次启动依然蓝屏。</p>
<h4 id="进一步发现">进一步发现<a class="headerlink" href="#进一步发现" title="Permanent link">&para;</a></h4>
<p>重启linux时，如果直通的显卡上连着显示器，那么windows启动就会循环蓝屏。解决办法为先拔掉显示器，linux启动后再插上，之后启动VM-windows就不会蓝屏。</p>
<p>蓝屏时代码为</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>终止代码: VIDEO TDR FAILURE
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>失败的操作：nvlddmkm.sys
</span></code></pre></div>
<h4 id="解决">解决<a class="headerlink" href="#解决" title="Permanent link">&para;</a></h4>
<p>发现问题可能是由于将boot GPU直通导致的<a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Passing_the_boot_GPU_to_the_guest">PCI passthrough via OVMF - ArchWiki (archlinux.org)</a></p>
<blockquote>
<p>The GPU marked as <code>boot_vga</code> is a special case when it comes to doing PCI passthroughs, since the BIOS needs to use it in order to display things like boot messages or the BIOS configuration menu. To do that, it makes <a href="https://www.redhat.com/archives/vfio-users/2016-May/msg00224.html">a copy of the VGA boot ROM which can then be freely modified</a>.</p>
</blockquote>
<p>但是我的主板没办法调节使用哪个GPU作为启动GPU
在https://blog.twenska.de/blog/GPU_passthrough/中看到类似问题，并提到解决方法</p>
<p>查看<code>/var/log/libvirt/qemu/win10.log.0</code>会发现大量的以下错误：</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="m">2022</span>-07-21T06:50:56.222055Z<span class="w"> </span>qemu-system-x86_64:<span class="w"> </span>vfio_region_write<span class="o">(</span><span class="m">0000</span>:08:00.0:region1+0x345990,<span class="w"> </span>0x13801,8<span class="o">)</span><span class="w"> </span>failed:<span class="w"> </span>Device<span class="w"> </span>or<span class="w"> </span>resource<span class="w"> </span>busy
</span></code></pre></div>
<p>然后启动虚拟机前运行以下脚本即可</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/devices/0000<span class="se">\:</span><span class="m">08</span><span class="se">\:</span><span class="m">00</span>.0/remove<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/bus/pci/rescan
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>virsh<span class="w"> </span>start<span class="w"> </span>win10
</span></code></pre></div>
<p>发现Arch wiki提到相同的解决方法<a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#%22BAR_3:_cannot_reserve_[mem]%22_error_in_dmesg_after_starting_virtual_machine">BAR_3:_cannot_reserve[mem]</a></p>
<h3 id="parsec-报错">parsec 报错<a class="headerlink" href="#parsec-报错" title="Permanent link">&para;</a></h3>
<p><a href="https://support.parsec.app/hc/en-us/articles/360002165172">Error Codes - 14003 (Failed to Capture the Host Display) – Parsec</a>
导致这个错误的好多
- 少数游戏全屏会使得分辨率信息错误
- 关闭了显示器
- 同时使用windows rdp和parsec</p>
<ul>
<li>If running a headless system, or attempting to run Parsec from a virtual machine that has a GPU passed through to it, you will need to simulate a display being plugged into the GPU.</li>
<li>You can make use of <a href="https://support.parsec.app/hc/en-us/articles/360054478211">Parsec's virtual displays</a>, available in the host settings. The free version of Parsec has a "Fallback To Virtual Display" which adds a single virtual display if no other displays are present. <a href="https://support.parsec.app/hc/en-us/articles/360054478211">Learn how to set it up at the bottom of the virtual displays page</a></li>
<li>Alternatively, you can purchase a HDMI dongle to generate a monitor, (<a href="https://www.amazon.com/dp/B01EK05WTY/">we recommend this one</a>). Using an HDMI Dongle can be problematic if you also plan to physically use this host machine, as while the headless hdmi dongle is plugged in, you will have an invisible monitor at all times</li>
<li>On QUADRO or TESLA graphics you might be able to <a href="https://nvidia.custhelp.com/app/answers/detail/a_id/3569/">simulate an EDID via NVIDIA Control Panel</a></li>
</ul>
<p>For the best performance, you should close all RDP sessions before connecting with Parsec. Parsec is generally able to stay connected at the same time as RDP, but performance will be significantly worse. Since Windows 10 Build 1903, WDDM graphics mode causes bugs while Parsec and RDP are used together. If you get error -14003, turn off WDDM graphics in favor of XDDM:</p>
<ul>
<li>Run "Edit group policy"</li>
<li>Navigate to Local Computer Policy &gt; Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Remote Desktop Services &gt; Remote Desktop Session Host &gt; Remote Session Environment</li>
<li>Set "Use WDDM graphics display driver..." to "Disabled"</li>
</ul>
<h3 id="seabios-or-ovmf">SeaBIOS or OVMF<a class="headerlink" href="#seabios-or-ovmf" title="Permanent link">&para;</a></h3>
<p>OVMF is an open-source UEFI firmware for QEMU virtual machines. While it is possible to use SeaBIOS to get similar results to an actual PCI passthrough, the setup process is different and it is generally preferable to use the EFI method if your hardware supports it.</p>
<h3 id="amd-5600xt直通后code43">AMD 5600XT直通后code43<a class="headerlink" href="#amd-5600xt直通后code43" title="Permanent link">&para;</a></h3>
<p>从原本的1060 3g换成了5600xt。
刚开始进入系统，显卡显示显示适配器，code 31。过了一会儿之后，自己安装驱动，识别出是5600xt了。
但是显示器仍然是黑屏，显示code 43。按照arch wiki上写的
- AMD或者老版Nvidia驱动（新版nv驱动不会）会识别是虚拟机从而拒绝工作。xml需要添加配置。
<div class="language-xml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$<span class="w"> </span>virsh<span class="w"> </span>edit<span class="w"> </span>vmname
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="nt">&lt;features&gt;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">  </span><span class="nt">&lt;hyperv&gt;</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span>...
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="w">    </span><span class="nt">&lt;vendor_id</span><span class="w"> </span><span class="na">state=</span><span class="s">&#39;on&#39;</span><span class="w"> </span><span class="na">value=</span><span class="s">&#39;randomid&#39;</span><span class="nt">/&gt;</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="w">  </span><span class="nt">&lt;/hyperv&gt;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="w">  </span>#<span class="w"> </span>nv需要额外添加以下配置
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">  </span><span class="nt">&lt;kvm&gt;</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="nt">&lt;hidden</span><span class="w"> </span><span class="na">state=</span><span class="s">&#39;on&#39;</span><span class="nt">/&gt;</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="w">  </span><span class="nt">&lt;/kvm&gt;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="nt">&lt;/features&gt;</span>
</span></code></pre></div></p>
<p>但是我试了之后还是不行，randomid我试了改为"012345678ab"也不行（来自其它博客）</p>
<p>注意到我启动host时，ubuntu启动界面是显示在插在AMD gpu上的显示器，而非不显卡直通的显示器。因此怀疑是不是因为直通的显卡为boot显卡，导致传入虚拟机的显卡bios被修改过了。导致驱动报错。</p>
<blockquote>
<p>The GPU marked as <code>boot_vga</code> is a special case when it comes to doing PCI passthroughs, since the BIOS needs to use it in order to display things like boot messages or the BIOS configuration menu. To do that, it makes <a href="https://www.redhat.com/archives/vfio-users/2016-May/msg00224.html">a copy of the VGA boot ROM which can then be freely modified</a>. This modified copy is the version the system gets to see, which the passthrough driver may reject as invalid. As such, it is generally recommended to change the boot GPU in the BIOS configuration so the host GPU is used instead or, if that is not possible, to swap the host and guest cards in the machine itself.</p>
</blockquote>
<p>于是尝试直通的显卡不插显示器启动host，<strong>虽然不知为bios自检显示显卡没通过，亮白灯</strong>，但是最终还是进了系统。期间，启动界面的logo颜色有点异常（显示器插在非直通的显卡上，后面发现貌似更新为nvidia驱动后（原本为nveau）没有该问题）</p>
<p>进入系统后，启动虚拟器，一切正常。</p>
<h3 id="安装nvidia驱动后启动会反复load-nvidia驱动">安装nvidia驱动后启动会反复load nvidia驱动<a class="headerlink" href="#安装nvidia驱动后启动会反复load-nvidia驱动" title="Permanent link">&para;</a></h3>
<p>相当于bind vifo不起作用？</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>NVRM: The NVIDIA probe routine was not called for 1 device(s)
</span></code></pre></div>
<p><a href="https://askubuntu.com/questions/1298461/how-to-temporarily-blacklist-nvidia-driver-at-boot-time">grub2 - How to temporarily blacklist nvidia driver at boot time - Ask Ubuntu</a></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>module_blacklist=nvidia
</span></code></pre></div>
<p><a href="https://www.reddit.com/r/VFIO/comments/90tg4h/after_loading_vfiopci_instead_of_nvidia_my_dmesg/">(8) After loading vfio-pci instead of nvidia, my dmesg has dozens of errors : VFIO (reddit.com)</a></p>
<p>理论上是不需要blacklist driver的，不然如果是两张nv的显卡，则另一张岂不是无法使用nvidia驱动？</p>
<blockquote>
<p>I have a setup with two nVidia cards (GTX 970 for passthrough and GT 1030 for Linux host) and I'm not blacklisting anything.</p>
</blockquote>
<p><a href="https://www.reddit.com/r/VFIO/comments/90tg4h/after_loading_vfiopci_instead_of_nvidia_my_dmesg/">(8) After loading vfio-pci instead of nvidia, my dmesg has dozens of errors : VFIO (reddit.com)</a>
/etc/modprobe.d/nvidia.conf: (You probably will have to create this file.)
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>softdep nvidia pre: vfio-pci
</span></code></pre></div></p>
<h3 id="1070--1060">1070 + 1060<a class="headerlink" href="#1070--1060" title="Permanent link">&para;</a></h3>
<p>安装了nvidia-driver-535-server-open
结果启动时报
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>NVRM cpuidInfoAMD: unrecognized amd processor in cpuidinfoamd
</span></code></pre></div>
然后进入紧急模式。
- 远程kvm看不到画面，回到实验室后，插上物理显示器也看不到输出。
- 强制重启后可以看到输出，然后就进入了紧急模式</p>
<p>通过moudle_blacklist=nvidia，可以进入系统。（结果系统的网络出了问题，ping等都没有问题，但是一旦curl就卡住，不清楚为什么）</p>
<p>binding vfio
- 为了防止host访问gpu，设置的一个placeholder驱动
- 有两种方式bind：linux kernel cmdline，modprobe.d（需要修改initramfs）</p>
<p>early bind
- modprobe
- 直接加载到initramfs，可能会导致initramfs变大，加载变慢
  - mkinitcpio, booster等方式</p>
<blockquote>
<p>If you are modesetting the <code>nvidia</code> driver, the <code>vfio-pci.ids</code> must be embedded in the initramfs image. If given via kernel arguments, they will be read too late to take effect. Follow the instructions in <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Binding_vfio-pci_via_device_ID">#Binding vfio-pci via device ID</a> for adding the ids to a modprobe conf file.</p>
</blockquote>
<h2 id="性能优化">性能优化<a class="headerlink" href="#性能优化" title="Permanent link">&para;</a></h2>
<p>https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html-single/virtualization_tuning_and_optimization_guide/index</p>
<h2 id="其它">其它<a class="headerlink" href="#其它" title="Permanent link">&para;</a></h2>
<h3 id="using-looking-glass-to-stream-guest-screen-to-the-host">Using Looking Glass to stream guest screen to the host<a class="headerlink" href="#using-looking-glass-to-stream-guest-screen-to-the-host" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/gnif/LookingGlass">gnif/LookingGlass: An extremely low latency KVMFR (KVM FrameRelay) implementation for guests with VGA PCI Passthrough. (github.com)</a></p>
<h2 id="acs-patch">ACS patch<a class="headerlink" href="#acs-patch" title="Permanent link">&para;</a></h2>
<p>最早的patch：<a href="https://lkml.org/lkml/2013/5/30/513">LKML: Alex Williamson: [PATCH] pci: Enable overrides for missing ACS capabilities</a></p>
<p><a href="https://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html">VFIO tips and tricks: IOMMU Groups, inside and out</a>
<a href="http://vfio.blogspot.com/2014/08/vfiovga-faq.html">VFIO tips and tricks: VFIO+VGA FAQ</a></p>
<p>自动编译内核
<a href="https://github.com/mdPlusPlus/VFIO">mdPlusPlus/VFIO: This repository contains all my work in the VFIO space (github.com)</a></p>
<p>acs_patch id用法：<a href="https://forum.proxmox.com/threads/help-with-pci-express-passthrough-acs-iommu-issue-kernel-bugfix.37151/">Help with PCI Express passthrough (ACS - IOMMU issue) + kernel bugfix | Proxmox Support Forum</a></p>
<p>其它：
这个vendor-reset是干嘛用的：
<a href="https://github.com/gnif/vendor-reset">gnif/vendor-reset: Linux kernel vendor specific hardware reset module for sequences that are too complex/complicated to land in pci_quirks.c (github.com)</a>
提到安全：<a href="https://www.reddit.com/r/VFIO/comments/ybda5c/is_acs_override_really_that_unsafe/">(4) Is ACS override really that unsafe? : VFIO (reddit.com)</a></p>
<h2 id="附录">附录<a class="headerlink" href="#附录" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>➜  ~ lspci -tv
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>-[0000:00]-+-00.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse Root Complex
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>           +-00.2  Advanced Micro Devices, Inc. [AMD] Starship/Matisse IOMMU
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>           +-01.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>           +-01.1-[01]----00.0  Samsung Electronics Co Ltd NVMe SSD Controller PM9A1/PM9A3/980PRO
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>           +-01.2-[02-07]--+-00.0  Advanced Micro Devices, Inc. [AMD] 500 Series Chipset USB 3.1 XHCI Controller
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>           |               +-00.1  Advanced Micro Devices, Inc. [AMD] 500 Series Chipset SATA Controller
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>           |               \-00.2-[03-07]--+-00.0-[04]--+-00.0  Advanced Micro Devices, Inc. [AMD/ATI] Baffin [Radeon RX 550 640SP / RX 560/560X]
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>           |                               |            \-00.1  Advanced Micro Devices, Inc. [AMD/ATI] Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X]
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>           |                               +-04.0-[05]----00.0  KIOXIA Corporation NVMe SSD
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>           |                               +-08.0-[06]----00.0  Intel Corporation Wi-Fi 6 AX200
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>           |                               \-09.0-[07]----00.0  Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>           +-02.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>           +-03.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>           +-03.1-[08]--+-00.0  NVIDIA Corporation GP106 [GeForce GTX 1060 3GB]
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>           |            \-00.1  NVIDIA Corporation GP106 High Definition Audio Controller
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>           +-04.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>           +-05.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>           +-07.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>           +-07.1-[09]----00.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Function
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>           +-08.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>           +-08.1-[0a]--+-00.0  Advanced Micro Devices, Inc. [AMD] Starship/Matisse Reserved SPP
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>           |            +-00.1  Advanced Micro Devices, Inc. [AMD] Starship/Matisse Cryptographic Coprocessor PSPCPP
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>           |            +-00.3  Advanced Micro Devices, Inc. [AMD] Matisse USB 3.0 Host Controller
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>           |            \-00.4  Advanced Micro Devices, Inc. [AMD] Starship/Matisse HD Audio Controller
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>           +-14.0  Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>           +-14.3  Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#__codelineno-26-28"></a>           +-18.0  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 0
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#__codelineno-26-29"></a>           +-18.1  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 1
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#__codelineno-26-30"></a>           +-18.2  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 2
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#__codelineno-26-31"></a>           +-18.3  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 3
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#__codelineno-26-32"></a>           +-18.4  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 4
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#__codelineno-26-33"></a>           +-18.5  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 5
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#__codelineno-26-34"></a>           +-18.6  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 6
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#__codelineno-26-35"></a>           \-18.7  Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 7
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>➜  ~ sudo dmesg | grep -i acs
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-5.19.17 root=UUID=5d812412-e8a8-47c5-9dc0-505a28fc0eb9 ro quiet splash amd_iommu=on kvm.ignore_msrs=1 vfio_pci.ids=10de:1c02,10de:10f1 pcie_acs_override=multifunction vt.handoff=7
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>[    0.000000] Warning: PCIe ACS overrides enabled; This may allow non-IOMMU protected peer-to-peer DMA
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>[    0.004417] ACPI: FACS 0x00000000AAEDA000 000040
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>[    0.004452] ACPI: Reserving FACS table memory at [mem 0xaaeda000-0xaaeda03f]
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>[    0.074290] Kernel command line: BOOT_IMAGE=/boot/vmlinuz-5.19.17 root=UUID=5d812412-e8a8-47c5-9dc0-505a28fc0eb9 ro quiet splash amd_iommu=on kvm.ignore_msrs=1 vfio_pci.ids=10de:1c02,10de:10f1 pcie_acs_override=multifunction vt.handoff=7
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>➜  scripts ./iommu-viewer.sh
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>Please be patient. This may take a couple seconds.
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>Group:  0   0000:00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>Group:  1   0000:00:01.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>Group:  2   0000:00:01.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>Group:  3   0000:00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>Group:  4   0000:00:03.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>Group:  5   0000:00:03.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse GPP Bridge [1022:1483]   Driver: pcieport
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>Group:  6   0000:00:04.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>Group:  7   0000:00:05.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>Group:  8   0000:00:07.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>Group:  9   0000:00:07.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>Group:  10  0000:00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Host Bridge [1022:1482]
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>Group:  11  0000:00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Internal PCIe GPP Bridge 0 to bus[E:B] [1022:1484]   Driver: pcieport
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>Group:  12  0000:00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:790b] (rev 61)   Driver: piix4_smbus
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>Group:  12  0000:00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:790e] (rev 51)
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>Group:  13  0000:00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 0 [1022:1440]
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>Group:  13  0000:00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 1 [1022:1441]
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>Group:  13  0000:00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 2 [1022:1442]
</span><span id="__span-28-20"><a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>Group:  13  0000:00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 3 [1022:1443]   Driver: k10temp
</span><span id="__span-28-21"><a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>Group:  13  0000:00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 4 [1022:1444]
</span><span id="__span-28-22"><a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>Group:  13  0000:00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 5 [1022:1445]
</span><span id="__span-28-23"><a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>Group:  13  0000:00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 6 [1022:1446]
</span><span id="__span-28-24"><a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>Group:  13  0000:00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Matisse/Vermeer Data Fabric: Device 18h; Function 7 [1022:1447]
</span><span id="__span-28-25"><a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>Group:  14  0000:01:00.0 Non-Volatile memory controller [0108]: Samsung Electronics Co Ltd NVMe SSD Controller PM9A1/PM9A3/980PRO [144d:a80a]   Driver: nvme
</span><span id="__span-28-26"><a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>Group:  15  0000:02:00.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] 500 Series Chipset USB 3.1 XHCI Controller [1022:43ee]   Driver: xhci_hcd
</span><span id="__span-28-27"><a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>Group:  16  0000:02:00.1 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD] 500 Series Chipset SATA Controller [1022:43eb]   Driver: ahci
</span><span id="__span-28-28"><a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>Group:  17  0000:02:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] 500 Series Chipset Switch Upstream Port [1022:43e9]   Driver: pcieport
</span><span id="__span-28-29"><a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>Group:  18  0000:03:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-28-30"><a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>Group:  18  0000:04:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin [Radeon RX 550 640SP / RX 560/560X] [1002:67ff] (rev ff)   Driver: amdgpu
</span><span id="__span-28-31"><a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>Group:  18  0000:04:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Baffin HDMI/DP Audio [Radeon RX 550 640SP / RX 560/560X] [1002:aae0]   Driver: snd_hda_intel
</span><span id="__span-28-32"><a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>Group:  19  0000:03:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-28-33"><a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>Group:  19  0000:05:00.0 Non-Volatile memory controller [0108]: KIOXIA Corporation NVMe SSD [1e0f:0009] (rev 01)   Driver: nvme
</span><span id="__span-28-34"><a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>Group:  20  0000:03:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-28-35"><a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>Group:  20  0000:06:00.0 Network controller [0280]: Intel Corporation Wi-Fi 6 AX200 [8086:2723] (rev 1a)   Driver: iwlwifi
</span><span id="__span-28-36"><a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>Group:  21  0000:03:09.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]   Driver: pcieport
</span><span id="__span-28-37"><a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>Group:  21  0000:07:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8125 2.5GbE Controller [10ec:8125] (rev 05)   Driver: r8169
</span><span id="__span-28-38"><a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>Group:  22  0000:08:00.0 VGA compatible controller [0300]: NVIDIA Corporation GP106 [GeForce GTX 1060 3GB] [10de:1c02] (rev a1)   Driver: vfio-pci
</span><span id="__span-28-39"><a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>Group:  23  0000:08:00.1 Audio device [0403]: NVIDIA Corporation GP106 High Definition Audio Controller [10de:10f1] (rev a1)   Driver: vfio-pci
</span><span id="__span-28-40"><a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>Group:  24  0000:09:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Function [1022:148a]
</span><span id="__span-28-41"><a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>Group:  25  0000:0a:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Reserved SPP [1022:1485]
</span><span id="__span-28-42"><a id="__codelineno-28-42" name="__codelineno-28-42" href="#__codelineno-28-42"></a>Group:  26  0000:0a:00.1 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Cryptographic Coprocessor PSPCPP [1022:1486]   Driver: ccp
</span><span id="__span-28-43"><a id="__codelineno-28-43" name="__codelineno-28-43" href="#__codelineno-28-43"></a>Group:  27  0000:0a:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Matisse USB 3.0 Host Controller [1022:149c]   Driver: xhci_hcd
</span><span id="__span-28-44"><a id="__codelineno-28-44" name="__codelineno-28-44" href="#__codelineno-28-44"></a>Group:  28  0000:0a:00.4 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse HD Audio Controller [1022:1487]   Driver: snd_hda_intel
</span></code></pre></div>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../11/2022-07-11-%E5%8F%B0%E5%BC%8F%E6%9C%BA%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 台式机改造计划">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                台式机改造计划
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../../%E5%8D%9A%E5%AE%A2/2022/07/19/2022-07-19-vnc%E5%92%8Crdp%E8%BF%9C%E7%A8%8B/" class="md-footer__link md-footer__link--next" aria-label="下一页: vnc和rdp远程">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                vnc和rdp远程
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TheRainstorm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>