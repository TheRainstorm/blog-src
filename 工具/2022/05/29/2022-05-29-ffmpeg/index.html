
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录一些关于数学、计算机的知识，以及一些日常。">
      
      
      
        <link rel="canonical" href="https://yfy.cqu.ai/%E5%B7%A5%E5%85%B7/2022/05/29/2022-05-29-ffmpeg/">
      
      
        <link rel="prev" href="../../../../../%E6%8A%98%E8%85%BE/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/">
      
      
        <link rel="next" href="../../../../../%E5%8D%9A%E5%AE%A2/2022/07/01/2022-07-01-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%BD%91%E7%BB%9C%E9%A3%8E%E6%B3%A2/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>ffmpeg - Rain的随笔</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#基础" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../.." title="Rain的随笔" class="md-header__button md-logo" aria-label="Rain的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Rain的随笔
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ffmpeg
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../../../.." class="md-tabs__link">
        
  
    
  
  博客

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../about/" class="md-tabs__link">
        
  
    
  
  关于

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tags/" class="md-tabs__link">
        
  
    
  
  标签

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../series/" class="md-tabs__link">
        
  
    
  
  系列

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../tools/" class="md-tabs__link">
        
  
    
  
  工具

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../archive/2024/" class="md-tabs__link">
          
  
  归档

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../category/homelab/" class="md-tabs__link">
          
  
  分类

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Rain的随笔" class="md-nav__button md-logo" aria-label="Rain的随笔" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Rain的随笔
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tags/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    标签
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../series/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系列
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    归档
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            归档
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2021
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    分类
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            分类
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/homelab/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    homelab
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E4%B8%AA%E4%BA%BA/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    个人
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%8D%9A%E5%AE%A2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    博客
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E7%BD%91%E7%BB%9C%E8%87%AA%E7%94%B1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    如何实现网络自由
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    学习
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E5%B7%A5%E5%85%B7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    工具
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%8A%98%E8%85%BE/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    折腾
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E6%9D%82%E6%96%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    杂文
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E7%BC%96%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%99%9A%E6%8B%9F%E5%8C%96/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    虚拟化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AE%BE%E5%A4%87/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    设备
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E8%AF%BE%E7%A8%8B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    课程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../../category/%E9%98%85%E8%AF%BB/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    阅读
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    回到主页
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    元数据
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                        <time datetime="2022-05-29 18:14:50" class="md-ellipsis">2022年5月29日</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                          <span class="md-ellipsis">
                            分类于
                            
                              <a href="../../../../../category/%E5%B7%A5%E5%85%B7/">工具</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                          <span class="md-ellipsis">
                            
                              需要 25 分钟阅读时间
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#基础" class="md-nav__link">
    <span class="md-ellipsis">
      基础
    </span>
  </a>
  
    <nav class="md-nav" aria-label="基础">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ffmpeg流程" class="md-nav__link">
    <span class="md-ellipsis">
      ffmpeg流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#filter" class="md-nav__link">
    <span class="md-ellipsis">
      filter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="filter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simple-filter" class="md-nav__link">
    <span class="md-ellipsis">
      simple filter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complex-filter" class="md-nav__link">
    <span class="md-ellipsis">
      Complex filter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-selection" class="md-nav__link">
    <span class="md-ellipsis">
      stream selection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="stream selection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#自动选择" class="md-nav__link">
    <span class="md-ellipsis">
      自动选择
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#map选项" class="md-nav__link">
    <span class="md-ellipsis">
      map选项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stream-handling" class="md-nav__link">
    <span class="md-ellipsis">
      stream handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#options" class="md-nav__link">
    <span class="md-ellipsis">
      Options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stream-specifier" class="md-nav__link">
    <span class="md-ellipsis">
      stream specifier
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-options" class="md-nav__link">
    <span class="md-ellipsis">
      main options
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quick-start" class="md-nav__link">
    <span class="md-ellipsis">
      quick start
    </span>
  </a>
  
    <nav class="md-nav" aria-label="quick start">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#命令格式" class="md-nav__link">
    <span class="md-ellipsis">
      命令格式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#常用参数" class="md-nav__link">
    <span class="md-ellipsis">
      常用参数
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#查看支持的编码器" class="md-nav__link">
    <span class="md-ellipsis">
      查看支持的编码器
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#心得坑" class="md-nav__link">
    <span class="md-ellipsis">
      心得(坑)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#常用命令" class="md-nav__link">
    <span class="md-ellipsis">
      常用命令
    </span>
  </a>
  
    <nav class="md-nav" aria-label="常用命令">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#查看文件元信息" class="md-nav__link">
    <span class="md-ellipsis">
      查看文件元信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#提取音频" class="md-nav__link">
    <span class="md-ellipsis">
      提取音频
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#截图" class="md-nav__link">
    <span class="md-ellipsis">
      截图
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#参考资料" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#截取seeking位置" class="md-nav__link">
    <span class="md-ellipsis">
      截取Seeking位置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="截取Seeking位置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#查看关键帧方法" class="md-nav__link">
    <span class="md-ellipsis">
      查看关键帧方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-seeking" class="md-nav__link">
    <span class="md-ellipsis">
      input seeking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="input seeking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#实验" class="md-nav__link">
    <span class="md-ellipsis">
      实验
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-seeking" class="md-nav__link">
    <span class="md-ellipsis">
      output seeking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#一些选项" class="md-nav__link">
    <span class="md-ellipsis">
      一些选项
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#转码" class="md-nav__link">
    <span class="md-ellipsis">
      转码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="转码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#音频" class="md-nav__link">
    <span class="md-ellipsis">
      音频
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h264" class="md-nav__link">
    <span class="md-ellipsis">
      h264
    </span>
  </a>
  
    <nav class="md-nav" aria-label="h264">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crf" class="md-nav__link">
    <span class="md-ellipsis">
      CRF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#h265" class="md-nav__link">
    <span class="md-ellipsis">
      h265
    </span>
  </a>
  
    <nav class="md-nav" aria-label="h265">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crf_1" class="md-nav__link">
    <span class="md-ellipsis">
      CRF
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#av1" class="md-nav__link">
    <span class="md-ellipsis">
      av1
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#调节帧数" class="md-nav__link">
    <span class="md-ellipsis">
      调节帧数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu硬件加速" class="md-nav__link">
    <span class="md-ellipsis">
      GPU硬件加速
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPU硬件加速">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vaapi测试" class="md-nav__link">
    <span class="md-ellipsis">
      vaapi测试
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#时间戳相关" class="md-nav__link">
    <span class="md-ellipsis">
      时间戳相关
    </span>
  </a>
  
    <nav class="md-nav" aria-label="时间戳相关">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#选项" class="md-nav__link">
    <span class="md-ellipsis">
      选项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ffmpeg输出时间戳默认会置为0" class="md-nav__link">
    <span class="md-ellipsis">
      ffmpeg输出时间戳默认会置为0
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ffmpeg合并视频和音频默认居然会有问题" class="md-nav__link">
    <span class="md-ellipsis">
      ffmpeg合并视频和音频，默认居然会有问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delay某个流" class="md-nav__link">
    <span class="md-ellipsis">
      delay某个流
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b站问题" class="md-nav__link">
    <span class="md-ellipsis">
      B站问题
    </span>
  </a>
  
    <nav class="md-nav" aria-label="B站问题">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#为什么seek-0638s结果导致video起始变成了41s" class="md-nav__link">
    <span class="md-ellipsis">
      为什么seek 0.638s，结果导致video起始变成了4.1s
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#感觉问题在于为什么自己的视频video和audio-duration相差没那么大而b站转码后就相差05s了" class="md-nav__link">
    <span class="md-ellipsis">
      感觉问题在于为什么自己的视频video和audio duration相差没那么大，而B站转码后，就相差0.5s了
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#猜想问题原因" class="md-nav__link">
    <span class="md-ellipsis">
      猜想问题原因
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#其它" class="md-nav__link">
    <span class="md-ellipsis">
      其它
    </span>
  </a>
  
    <nav class="md-nav" aria-label="其它">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#发现原始视频有两个audio" class="md-nav__link">
    <span class="md-ellipsis">
      发现原始视频有两个audio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#youtube没问题" class="md-nav__link">
    <span class="md-ellipsis">
      youtube没问题
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#设置输入和输出pts" class="md-nav__link">
    <span class="md-ellipsis">
      设置输入和输出pts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  
  

<nav class="md-tags" >
  
    
    
    
      <a href="../../../../../tags/#ffmpeg" class="md-tag">ffmpeg</a>
    
  
</nav>



  <h1>ffmpeg</h1>

<p>ffmpeg</p>
<!-- more -->

<h2 id="基础">基础<a class="headerlink" href="#基础" title="Permanent link">&para;</a></h2>
<ul>
<li>ffmpeg读取任意个input（使用-i指定），写到任意个输出（通过plain output url指定）</li>
<li>每个输出或者输出可以包含任意数量的不同类型的流(stream)，streams种类有<code>video/audio/subtitle/attachment/data</code></li>
<li>stream的类型和数量受容器格式(container format)影响，从哪些input选取哪些流，输出到哪些output的过程（<strong>stream selection</strong>）既可以是自动的也可以通过<code>-map</code>指定。</li>
<li><strong>options对下一个文件起作用</strong>，可以重复相同的选项</li>
<li>引用input或者stream，可以使用从0开始的索引。比如第一个输入是<code>0</code>，<code>2:3</code> 表示第3个文件的第4个流</li>
</ul>
<p>一些简单的例子</p>
<p>Convert an input media file to a different format, by re-encoding media streams:
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>ffmpeg -i input.avi output.mp4
</span></code></pre></div>
Set the video bitrate of the output file to 64 kbit/s:
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>ffmpeg -i input.avi -b:v 64k -bufsize 64k output.mp4
</span></code></pre></div>
Force the frame rate of the output file to 24 fps:
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>ffmpeg -i input.avi -r 24 output.mp4
</span></code></pre></div>
Force the frame rate of the input file (valid for raw formats only) to 1 fps and the frame rate of the output file to 24 fps:
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>ffmpeg -r 1 -i input.m2v -r 24 output.mp4
</span></code></pre></div></p>
<h3 id="ffmpeg流程">ffmpeg流程<a class="headerlink" href="#ffmpeg流程" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>decode -&gt; filter -&gt; encode</strong></li>
<li>使用copy选项时，可以跳过decode。Encoded packets are then passed to the decoder (unless streamcopy is selected for the stream, see further for a description).
  <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a> _______              ______________
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>|       |            |              |
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>| input |  demuxer   | encoded data |   decoder
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>| file  | ---------&gt; | packets      | -----+
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>|_______|            |______________|      |
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>                                           v
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>                                       _________
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>                                      |         |
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>                                      | decoded |
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>                                      | frames  |
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>                                      |_________|
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a> ________             ______________       |
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>|        |           |              |      |
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>| output | &lt;-------- | encoded data | &lt;----+
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>| file   |   muxer   | packets      |   encoder
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>|________|           |______________|
</span></code></pre></div></li>
</ul>
<h3 id="filter">filter<a class="headerlink" href="#filter" title="Permanent link">&para;</a></h3>
<h4 id="simple-filter">simple filter<a class="headerlink" href="#simple-filter" title="Permanent link">&para;</a></h4>
<ul>
<li>一个输入，一个输出，类型相同</li>
<li>对每个流使用-filter选项。-vf, -af是video和audio的别名
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>_________                        ______________
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>|         |                      |              |
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>| decoded |                      | encoded data |
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>| frames  |\                   _ | packets      |
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>|_________| \                  /||______________|
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>           \   __________   /
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>simple     _\||          | /  encoder
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>filtergraph   | filtered |/
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>              | frames   |
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>              |__________|
</span></code></pre></div></li>
</ul>
<h4 id="complex-filter">Complex filter<a class="headerlink" href="#complex-filter" title="Permanent link">&para;</a></h4>
<p>Complex filter graphs are those which cannot be described as simply a linear processing chain applied to one stream.
- 多个输入或输出
- 使用<code>-filter_complex</code>
- 默认是全局的选项</p>
<p>例子</p>
<p>overlay：将一个视频叠加到另一个视频上</p>
<p>Define a complex filtergraph, i.e. one with arbitrary number of inputs and/or outputs.  “Filtergraph syntax” section of the ffmpeg-filters manual.</p>
<p>Input link labels must refer to input streams using the <code>[file_index:stream_specifier]</code> syntax (i.e. the same as -map uses). If stream_specifier matches multiple streams, the first one will be used. An unlabeled input will be connected to the first unused input stream of the matching type.</p>
<p>Output link labels are referred to with -map. Unlabeled outputs are added to the first output file.</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>ffmpeg -i video.mkv -i image.png -filter_complex &#39;[0:v][1:v]overlay[out]&#39; -map
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>        &#39;[out]&#39; out.mkv
</span></code></pre></div>
<h3 id="stream-selection">stream selection<a class="headerlink" href="#stream-selection" title="Permanent link">&para;</a></h3>
<h4 id="自动选择">自动选择<a class="headerlink" href="#自动选择" title="Permanent link">&para;</a></h4>
<ul>
<li>根据output文件的类型，决定是否包含video/audio/subtitles等各种类型的流</li>
<li>流选择的具体规则</li>
<li>for video, it is the stream with the highest resolution,</li>
<li>for audio, it is the stream with the most channels,</li>
<li>for subtitles, it is the first subtitle stream found but there’s a caveat. The output format’s default subtitle encoder can be either text-based or image-based, and only a subtitle stream of the same type will be chosen.</li>
</ul>
<h4 id="map选项">map选项<a class="headerlink" href="#map选项" title="Permanent link">&para;</a></h4>
<p><code>-map [-]input_file_id[:stream_specifier][?][,sync_file_id[:stream_specifier]] | [linklabel] (*output*)</code></p>
<p>Designate one or more input streams as a source for the output file. Each input stream is identified by the input file index input_file_id and the input stream index input_stream_id within the input file. Both indices start at 0. If specified, sync_file_id:stream_specifier sets which input stream is used as a presentation sync reference.</p>
<p>例子</p>
<p>For example, if you have two audio streams in the first input file, these streams are identified by "0:0" and "0:1". You can use <code>-map</code> to select which streams to place in an output file.</p>
<p>For example:
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>ffmpeg -i INPUT -map 0:1 out.wav
</span></code></pre></div>
will map the input stream in INPUT identified by "0:1" to the (single) output stream in out.wav.</p>
<p>For example, to select the stream with index 2 from input file a.mov (specified by the identifier "0:2"), and stream with index 6 from input b.mov (specified by the identifier "1:6"), and copy them to the output file out.mov:
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>ffmpeg -i a.mov -i b.mov -c copy -map 0:2 -map 1:6 out.mov
</span></code></pre></div></p>
<p>To select all video and the third audio stream from an input file:
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>ffmpeg -i INPUT -map 0:v -map 0:a:2 OUTPUT
</span></code></pre></div></p>
<p>To map all the streams except the second audio, use negative mappings
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>ffmpeg -i INPUT -map 0 -map -0:a:1 OUTPUT
</span></code></pre></div></p>
<p>To map the video and audio streams from the first input, and using the trailing <code>?</code>, ignore the audio mapping if no audio streams exist in the first input:
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>ffmpeg -i INPUT -map 0:v -map 0:a? OUTPUT
</span></code></pre></div></p>
<p>To pick the English audio stream:
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>ffmpeg -i INPUT -map 0:m:language:eng OUTPUT
</span></code></pre></div></p>
<p>Note that using this option disables the default mappings for this output file.</p>
<h3 id="stream-handling">stream handling<a class="headerlink" href="#stream-handling" title="Permanent link">&para;</a></h3>
<p>Stream handling is independent of stream selection, with an exception for subtitles described below. Stream handling is set via the <code>-codec</code> option addressed to streams within a specific <em>output</em> file. In particular, codec options are applied by ffmpeg after the stream selection process and thus do not influence the latter. If no <code>-codec</code> option is specified for a stream type, ffmpeg will select the default encoder registered by the output file muxer.
- 在stream selection之后进行
- 使用-codec指定对output中流的处理方式
- 如果没有指定-codec，则按照output文件格式选择默认的encoder</p>
<h3 id="options">Options<a class="headerlink" href="#options" title="Permanent link">&para;</a></h3>
<p><em>注意：ffmpeg很多选项，其关于input/output的位置的不同，会产生完全不同的效果</em></p>
<h4 id="stream-specifier">stream specifier<a class="headerlink" href="#stream-specifier" title="Permanent link">&para;</a></h4>
<p>对于一些针对某个流的选项（如-codec, -bitrate），使用stream specifier来指定针对哪个流。Some options are applied per-stream, e.g. bitrate or codec. Stream specifiers are used to precisely specify which stream(s) a given option belongs to.
如：
- -codec: a:1 ac3，指定第<strong>2</strong>个<strong>audio</strong>流的编码
- -codec:v copy指定复制video流（-codec or -codec:指定复制所有流）</p>
<h4 id="main-options">main options<a class="headerlink" href="#main-options" title="Permanent link">&para;</a></h4>
<ul>
<li><code>-c[:stream_specifier] codec (input/output,per-stream)</code>
  <strong>Select an encoder (when used before an output file) or a decoder (when used before an input file)</strong>  for one or more streams. codec is the name of a decoder/encoder or a special value copy (output only) to indicate that the stream is not to be re-encoded.</li>
</ul>
<p><div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>ffmpeg -i INPUT -map 0 -c:v libx264 -c:a copy OUTPUT
</span></code></pre></div>
  encodes all video streams with libx264 and copies all audio streams.</p>
<p>作用顺序为后者优先
  <div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>ffmpeg -i INPUT -map 0 -c copy -c:v:1 libx264 -c:a:137 libvorbis OUTPUT
</span></code></pre></div>
  will copy all the streams except the second video, which will be encoded with libx264, and the 138th audio, which will be encoded with libvorbis.</p>
<ul>
<li>
<p><code>-t duration (*input/output*)</code>
  When used as an input option (before <code>-i</code>), limit the duration of data read from the input file.
  When used as an output option (before an output url), stop writing the output after its duration reaches duration.</p>
</li>
<li>
<p><code>-ss position (*input/output*)</code>
    When used as an input option (before <code>-i</code>), seeks in this input file to position. </p>
<ul>
<li>Note that in most formats it is not possible to seek exactly, so <code>ffmpeg</code> will seek to the closest seek point before position. When transcoding and -accurate_seek is enabled (the default), this extra segment between the seek point and position will be decoded and discarded</li>
<li>When doing stream copy or when -noaccurate_seek is used, it will be preserved.
When used as an output option (before an output url), decodes but discards input until the timestamps reach position.</li>
</ul>
</li>
<li>
<p><code>-to position (*input/output*)</code>
  Stop writing the output or reading the input at position.</p>
</li>
<li>
<p><code>-filter[:stream_specifier] filtergraph (*output,per-stream*)</code>
  Create the filtergraph specified by filtergraph and use it to filter the stream.</p>
</li>
</ul>
<p>filtergraph is a description of the filtergraph to apply to the stream, and must have a single input and a single output of the same type of the stream. In the filtergraph, the input is associated to the label <code>in</code>, and the output to the label <code>out</code>. See the ffmpeg-filters manual for more information about the filtergraph syntax.</p>
<ul>
<li>Video相关</li>
<li><code>-vn (input/output)</code>
    As an input option, <strong>blocks all video streams of a file from being filtered or being automatically selected or mapped for any output.</strong> See <code>-discard</code> option to disable streams individually.
    As an output option, disables video recording i.e. automatic selection or mapping of any video stream. For full manual control see the <code>-map</code> option.</li>
<li><code>-vcodec codec (output)</code></li>
<li><code>-vf filtergraph (output)</code>
    Create the filtergraph specified by filtergraph and use it to filter the stream.</li>
</ul>
<h2 id="quick-start">quick start<a class="headerlink" href="#quick-start" title="Permanent link">&para;</a></h2>
<p>参考：<a href="https://www.ruanyifeng.com/blog/2020/01/ffmpeg.html">FFmpeg 视频处理入门教程 - 阮一峰的网络日志 (ruanyifeng.com)</a></p>
<h3 id="命令格式">命令格式<a class="headerlink" href="#命令格式" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>$ ffmpeg \
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>[全局参数] \
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>[输入文件参数] \
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>-i [输入文件] \
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>[输出文件参数] \
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>[输出文件]
</span></code></pre></div>
<p>如下面的命令将 mp4 文件转成 webm 文件，这两个都是容器格式。输入的 mp4 文件的音频编码格式是 aac，视频编码格式是 H.264；输出的 webm 文件的视频编码格式是 VP9，音频格式是 Vorbis。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>$ ffmpeg \
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>-y \ # 全局参数
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>-c:a libfdk_aac -c:v libx264 \ # 输入文件参数
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>-i input.mp4 \ # 输入文件
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>-c:v libvpx-vp9 -c:a libvorbis \ # 输出文件参数
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>output.webm # 输出文件
</span></code></pre></div>
<h3 id="常用参数">常用参数<a class="headerlink" href="#常用参数" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>-c：指定编码器
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>-c copy：直接复制，不经过重新编码（这样比较快）
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>-c:v：指定视频编码器
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>-c:a：指定音频编码器
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>-i：指定输入文件
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>-an：去除音频流
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>-vn： 去除视频流
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>-preset：指定输出的视频质量，会影响文件的生成速度，有以下几个可用的值 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow。
</span></code></pre></div>
<h3 id="查看支持的编码器">查看支持的编码器<a class="headerlink" href="#查看支持的编码器" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>~ ffmpeg.exe -encoders |grep av1
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a> V..... libaom-av1           libaom AV1 (codec av1)
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a> V....D librav1e             librav1e AV1 (codec av1)
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a> V..... libsvtav1            SVT-AV1(Scalable Video Technology for AV1) encoder (codec av1)
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>~ ffmpeg.exe -encoders |grep HEVC
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a> V..... libx265              libx265 H.265 / HEVC (codec hevc)
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a> V....D hevc_amf             AMD AMF HEVC encoder (codec hevc)
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a> V....D hevc_mf              HEVC via MediaFoundation (codec hevc)
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>~ ffmpeg.exe -encoders |grep h264
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>V..... libx264              libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a> V..... libx264rgb           libx264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 RGB (codec h264)
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a> V..... libopenh264          OpenH264 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (codec h264)
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a> V....D h264_amf             AMD AMF H.264 Encoder (codec h264)
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a> V....D h264_mf              H264 via MediaFoundation (codec h264)
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a> V....D h264_nvenc           NVIDIA NVENC H.264 encoder (codec h264)
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a> V..... h264_qsv             H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (Intel Quick Sync Video acceleration) (codec h264)
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a> V..... nvenc                NVIDIA NVENC H.264 encoder (codec h264)
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a> V..... nvenc_h264           NVIDIA NVENC H.264 encoder (codec h264)
</span></code></pre></div>
<h2 id="心得坑">心得(坑)<a class="headerlink" href="#心得坑" title="Permanent link">&para;</a></h2>
<ul>
<li>流复制不用转码是很好，但是会导致各种问题。比如seek不精确、seek后视频和音频长度相差几百ms。因此剪辑视频最稳妥起见还是重新转码一下</li>
<li>转码时crf一定要选好，默认的码率是很低的
h265</li>
<li>crf 26: 11mbps（B站转成h264就剩10mb了，但实际最高可达18mb）</li>
<li>crf 20: 22281kb</li>
<li>crf 16: 34894kb</li>
</ul>
<h2 id="常用命令">常用命令<a class="headerlink" href="#常用命令" title="Permanent link">&para;</a></h2>
<h3 id="查看文件元信息">查看文件元信息<a class="headerlink" href="#查看文件元信息" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>ffmpeg -i input.mp4 -hide_banner
</span></code></pre></div>
<h3 id="提取音频">提取音频<a class="headerlink" href="#提取音频" title="Permanent link">&para;</a></h3>
<p>输出文件可以选择不同容器格式，根据音频编码选择。（如m4a, mp3，也可以直接用mkv存储）
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>$ ffmpeg -i input.mp4 -vn -c:a copy output.aac
</span></code></pre></div></p>
<h3 id="截图">截图<a class="headerlink" href="#截图" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>$ ffmpeg -i input.mp4 -ss 00:01:24 -t 00:00:01 output_%3d.jpg
</span></code></pre></div>
<p><code>-vframes 1</code>指定只截取一帧，<code>-q:v 2</code>表示输出的图片质量，一般是1到5之间（1 为质量最高）。</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>$ ffmpeg -ss 01:23:45 -i input -vframes 1 -q:v 2 output.jpg
</span></code></pre></div>
<h2 id="参考资料">参考资料<a class="headerlink" href="#参考资料" title="Permanent link">&para;</a></h2>
<p><a href="https://ffmpeg.org/ffmpeg-formats.html">FFmpeg Formats Documentation</a>
-fflags flags是另外的选项
- ‘genpts’：Generate missing PTS if DTS is present.</p>
<p><a href="https://stackoverflow.com/questions/51085133/does-pts-have-to-start-at-0">video - Does PTS have to start at 0? - Stack Overflow</a>
- 想让start_pts包含实际时间信息</p>
<p><a href="https://stackoverflow.com/questions/53388471/ffmpeg-setpts-apply-uniform-offset-without-re-encoding">video - ffmpeg setpts apply uniform offset without re-encoding - Stack Overflow</a>
- 两个流，知道结尾，因此可以同步
- 使用setpts filter可以做到，但是想要避免转码</p>
<h2 id="截取seeking位置">截取Seeking位置<a class="headerlink" href="#截取seeking位置" title="Permanent link">&para;</a></h2>
<p><strong>一定要读</strong>：<a href="https://trac.ffmpeg.org/wiki/Seeking">Seeking – FFmpeg</a></p>
<p><strong>关键帧（Keyframes）</strong>：在视频编码中，关键帧是视频序列中的特殊帧，<strong>它们是独立的、不依赖于其他帧的帧</strong>。关键帧包含完整的图像信息，而其他帧（如P帧和B帧）则利用关键帧和/或其他帧的信息进行压缩。
关键帧是视频中的重要参考点，它们通常出现在视频场景变化或运动发生的地方。由于关键帧是独立的，视频播放器或解码器可以在任何关键帧处开始解码，而不需要依赖之前的帧。这有助于快速定位和随机访问视频。</p>
<p><strong>PTS（Presentation Timestamp）</strong>：
PTS是一个时间戳，表示视频或音频帧在播放时应该呈现的时间。PTS用于确定帧何时应该在播放时间轴上显示或播放。</p>
<p><strong>GOP（Group of Pictures）</strong>：GOP是视频序列中的一组帧，它包含一个关键帧（I帧）和一些后续帧，包括预测帧（P帧）和双向预测帧（B帧）。GOP的结构有助于视频压缩和解码。
典型的GOP结构可能是"IBBPBBPBBPBB"，其中"I"是关键帧，"B"是双向预测帧，"P"是预测帧。关键帧始终是GOP的第一个帧。</p>
<p><strong>关键帧和GOP的关系</strong>：
关键帧是GOP的起点，它定义了一个新的编码组，其后跟随一系列依赖于它的预测帧和双向预测帧。整个GOP的结构有助于在视频编码中实现高压缩比，因为预测帧和双向预测帧可以利用关键帧的信息进行差异编码，而不必携带完整的图像信息。
在视频流中，关键帧的选择和GOP的设置对于视频的质量、压缩效率和快速定位能力都具有重要影响。不同的应用和使用场景可能需要不同的关键帧间隔和GOP结构来平衡压缩效率和解码性能。</p>
<h3 id="查看关键帧方法">查看关键帧方法<a class="headerlink" href="#查看关键帧方法" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>ffprobe -select_streams v -show_frames -show_entries frame=pict_type,pkt_pts_time bbb_sunflower_1080p_30fps_normal.mp4 &gt; log
</span></code></pre></div>
<h3 id="input-seeking">input seeking<a class="headerlink" href="#input-seeking" title="Permanent link">&para;</a></h3>
<p>-ss  position (<em>input/output</em>)</p>
<p>When used as an input option (before <code>-i</code>), seeks in this input file to position. Note that in most formats it is not possible to seek exactly, so <code>ffmpeg</code> will seek to the closest seek point <strong>before</strong> position.</p>
<ul>
<li>简单理解为seek到I帧。</li>
<li>转码时：When transcoding and -accurate_seek is enabled (the default), this extra segment between the seek point and position will be decoded and discarded</li>
<li>copy时：When doing stream copy or when -noaccurate_seek is used, it will be preserved.</li>
<li>由于不能编解码，所以实际seek位置必须对应I帧，因此seek位置实际在pos最前的一个I帧，然后将ts置为0？</li>
</ul>
<h4 id="实验">实验<a class="headerlink" href="#实验" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mkv -t 10 ref/ref_%04d.png
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>f421d45d1b8b491dc36a564c01246ef8  i_ss_2-noacc.png
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>468a10a80c838526709d4d35abe7af3a  i_ss_2.png
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>(base) fyyuan@icarus4 ➜  test cat ref/log2|grep f421d45d1b8b491dc36a564c01246ef8
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>f421d45d1b8b491dc36a564c01246ef8  ref_0061.png
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>(base) fyyuan@icarus4 ➜  test cat ref/log2|grep 468a10a80c838526709d4d35abe7af3a
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>468a10a80c838526709d4d35abe7af3a  ref_0059.png
</span></code></pre></div>
<h3 id="output-seeking">output seeking<a class="headerlink" href="#output-seeking" title="Permanent link">&para;</a></h3>
<p>When used as an output option (before an output url), decodes but discards input until the timestamps reach position.
- 由于input已经被解码了，因此每帧的timestamp可以获得，seek到指定位置前的frame。
- Here, the input will be decoded (and discarded) until it reaches the position given by <code>-ss</code>. This will be done <strong>very slowly</strong>, frame by frame.
- As of FFmpeg 2.1, the main advantage is that when applying filters to the output stream, the <strong>timestamps aren't reset prior to filtering</strong> (i.e. when <a href="https://trac.ffmpeg.org/wiki/HowToBurnSubtitlesIntoVideo">​burning subtitles into a video</a>, you don't need to modify the subtitle timestamps),</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>ffprobe -select_streams v -show_frames -show_entries frame=pict_type,pkt_pts_time src.mkv
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>[FRAME]
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>pkt_pts_time=0.613000
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>pict_type=I
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>[/FRAME]
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>[FRAME]
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>pkt_pts_time=0.630000
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>pict_type=B
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>[/FRAME]
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>...
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>[FRAME]
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>pkt_pts_time=1.130000
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>pict_type=B
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>[/FRAME]
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>[FRAME]
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>pkt_pts_time=1.147000
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>pict_type=I
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>[/FRAME]
</span></code></pre></div>
<h3 id="一些选项">一些选项<a class="headerlink" href="#一些选项" title="Permanent link">&para;</a></h3>
<p>-copyts</p>
<p>Do not process input timestamps, but keep their values without trying to sanitize them. In particular, do not remove the initial start time offset value.
Note that, depending on the vsync option or on specific muxer processing (e.g. in case the format option avoid_negative_ts is enabled) the output timestamps may mismatch with the input timestamps even when this option is selected.</p>
<p>-start_at_zero</p>
<p>When used with copyts, shift input timestamps so they start at zero.
This means that using e.g. <code>-ss 50</code> will make output timestamps start at 50 seconds, regardless of what timestamp the input file started at.</p>
<p>-avoid_negative_ts integer (<em>output</em>)</p>
<p>Possible values:
‘make_non_negative’
Shift timestamps to make them non-negative. Also note that this affects only leading negative timestamps, and not non-monotonic negative timestamps.</p>
<p>‘make_zero’
Shift timestamps so that the first timestamp is 0.</p>
<p>‘auto (default)’
Enables shifting when required by the target format.</p>
<p>‘disabled’
Disables shifting of timestamp.</p>
<p>When shifting is enabled, all output timestamps are shifted by the same amount. Audio, video, and subtitles desynching and relative timestamp differences are preserved compared to how they would have been without shifting.</p>
<h2 id="转码">转码<a class="headerlink" href="#转码" title="Permanent link">&para;</a></h2>
<h3 id="音频">音频<a class="headerlink" href="#音频" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>fyyuan@icarus4<span class="w"> </span>➜<span class="w">  </span>Media<span class="w"> </span>ffmpeg<span class="w"> </span>-vn<span class="w"> </span>-i<span class="w"> </span>src.mkv<span class="w"> </span>-c:a<span class="w"> </span>aac<span class="w"> </span>-b:a<span class="w"> </span>256k<span class="w"> </span>audio.mp3
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>Stream<span class="w"> </span>mapping:
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">  </span>Stream<span class="w"> </span><span class="c1">#0:1 -&gt; #0:0 (aac_latm (native) -&gt; aac (native))</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>Press<span class="w"> </span><span class="o">[</span>q<span class="o">]</span><span class="w"> </span>to<span class="w"> </span>stop,<span class="w"> </span><span class="o">[</span>?<span class="o">]</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">help</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="o">[</span>mp3<span class="w"> </span>@<span class="w"> </span>0x564c9fc61340<span class="o">]</span><span class="w"> </span>Invalid<span class="w"> </span>audio<span class="w"> </span>stream.<span class="w"> </span>Exactly<span class="w"> </span>one<span class="w"> </span>MP3<span class="w"> </span>audio<span class="w"> </span>stream<span class="w"> </span>is<span class="w"> </span>required.
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>Could<span class="w"> </span>not<span class="w"> </span>write<span class="w"> </span>header<span class="w"> </span><span class="k">for</span><span class="w"> </span>output<span class="w"> </span>file<span class="w"> </span><span class="c1">#0 (incorrect codec parameters ?): Invalid argument</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>Error<span class="w"> </span>initializing<span class="w"> </span>output<span class="w"> </span>stream<span class="w"> </span><span class="m">0</span>:0<span class="w"> </span>--
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="o">[</span>aac<span class="w"> </span>@<span class="w"> </span>0x564c9fc60900<span class="o">]</span><span class="w"> </span>Qavg:<span class="w"> </span>nan
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>Conversion<span class="w"> </span>failed!
</span></code></pre></div>
<h3 id="h264">h264<a class="headerlink" href="#h264" title="Permanent link">&para;</a></h3>
<p><a href="https://trac.ffmpeg.org/wiki/Encode/H.264">Encode/H.264 – FFmpeg</a></p>
<p>两种模式
- CRF：不关心文件大小
- 2pass: 对文件大小有要求的场景，比如streaming</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>ffmpeg -i input -c:v libx264 -preset slow -crf 22 -c:a copy output.mkv
</span></code></pre></div>
<p>我使用这段参数转码h265的男子高中生S01E01，从514-&gt;320MB，结果质量很差
<div class="language-text highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a>ffmpeg.exe -i video.mkv -map 0 -c:v libx264 -crf 18 out-h264-cpu.mkv
</span></code></pre></div></p>
<h4 id="crf">CRF<a class="headerlink" href="#crf" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>ffmpeg -i INPUT -c:v libx264 -crf 22 -preset slow -tune film -profile:v high10 -c:a aac -b:a 320k  OUTPUT
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>frame=31195 fps= 52 q=-1.0 Lsize= 1789175kB time=00:08:41.00 bitrate=28132.0kbits/s speed=0.863x
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>video:1768370kB audio:20388kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.023303%
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>[libx264 @ 0x5600dc3637c0] frame I:149   Avg QP:30.35  size:340646
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>[libx264 @ 0x5600dc3637c0] frame P:8748  Avg QP:33.31  size:125510
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>[libx264 @ 0x5600dc3637c0] frame B:22298 Avg QP:36.79  size: 29693
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>[libx264 @ 0x5600dc3637c0] consecutive B-frames:  1.9%  7.6%  2.5% 88.0%
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>[libx264 @ 0x5600dc3637c0] mb I  I16..4: 35.7% 56.8%  7.6%
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>[libx264 @ 0x5600dc3637c0] mb P  I16..4: 19.4% 13.1%  0.6%  P16..4: 37.2%  7.4%  3.3%  0.0%  0.0%    skip:18.9%
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>[libx264 @ 0x5600dc3637c0] mb B  I16..4:  1.0%  0.9%  0.0%  B16..8: 28.7%  2.2%  0.3%  direct: 2.0%  skip:64.8%  L0:39.9% L1:52.9% BI: 7.1%
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>[libx264 @ 0x5600dc3637c0] 8x8 transform intra:41.3% inter:87.3%
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>[libx264 @ 0x5600dc3637c0] direct mvs  spatial:99.8% temporal:0.2%
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a>[libx264 @ 0x5600dc3637c0] coded y,uvDC,uvAC intra: 22.8% 49.0% 8.8% inter: 7.7% 12.4% 0.6%
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a>[libx264 @ 0x5600dc3637c0] i16 v,h,dc,p: 20% 24%  8% 49%
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a>[libx264 @ 0x5600dc3637c0] i8 v,h,dc,ddl,ddr,vr,hd,vl,hu: 12% 13% 13%  7% 11% 11% 13%  9% 11%
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a>[libx264 @ 0x5600dc3637c0] i4 v,h,dc,ddl,ddr,vr,hd,vl,hu: 13% 15%  8%  7% 13% 11% 13%  8% 12%
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a>[libx264 @ 0x5600dc3637c0] i8c dc,h,v,p: 45% 24% 15% 16%
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a>[libx264 @ 0x5600dc3637c0] Weighted P-Frames: Y:1.8% UV:1.0%
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a>[libx264 @ 0x5600dc3637c0] ref P L0: 74.3% 16.2%  5.7%  3.7%  0.1%  0.0%
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a>[libx264 @ 0x5600dc3637c0] ref B L0: 90.6%  6.6%  2.0%  0.8%
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a>[libx264 @ 0x5600dc3637c0] ref B L1: 98.3%  1.7%
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a>[libx264 @ 0x5600dc3637c0] kb/s:27827.21
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a>[aac @ 0x5600dc395700] Qavg: 174.559
</span></code></pre></div>
<h3 id="h265">h265<a class="headerlink" href="#h265" title="Permanent link">&para;</a></h3>
<p><a href="https://trac.ffmpeg.org/wiki/Encode/H.265">Encode/H.265 – FFmpeg</a></p>
<ul>
<li>
<p>Choose a CRF. CRF affects the quality. The default is 28, and it should visually correspond to libx264 video at CRF 23, but result in about half the file size. CRF works just like in x264, so choose the highest value that provides an acceptable quality.</p>
</li>
<li>
<p>Choose a preset. The default is <code>medium</code>. The preset determines compression efficiency and therefore affects encoding speed. Valid presets are <code>ultrafast</code>, <code>superfast</code>, <code>veryfast</code>, <code>faster</code>, <code>fast</code>, <code>medium</code>, <code>slow</code>, <code>slower</code>, <code>veryslow</code>, and <code>placebo</code>. Use the slowest preset you have patience for. Ignore <code>placebo</code> as it provides insignificant returns for a significant increase in encoding time.</p>
</li>
<li>
<p>Choose a tune (optional). By default, this is disabled, and it is generally not required to set a tune option. x265 supports the following <code>-tune</code> options: <code>psnr</code>, <code>ssim</code>, <code>grain</code>, <code>zerolatency</code>, <code>fastdecode</code>. They are explained in the <a href="https://trac.ffmpeg.org/wiki/Encode/H.264#crf">H.264 guide</a>.</p>
</li>
</ul>
<h4 id="crf_1">CRF<a class="headerlink" href="#crf_1" title="Permanent link">&para;</a></h4>
<p>直接转码，仍使用了原本的59.94fps
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a>ffmpeg -i INPUT -c:v libx265 -crf 26 -preset slow -c:a aac -b:a 320k OUTPUT
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>frame=31195 fps= 12 q=35.8 Lsize=  709168kB time=00:08:41.00 bitrate=11150.6kbits/s speed=0.195x
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>video:688379kB audio:20388kB subtitle:0kB other streams:0kB global headers:2kB muxing overhead: 0.056575%
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>x265 [info]: frame I:    132, Avg QP:27.54  kb/s: 60301.51
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>x265 [info]: frame P:   7805, Avg QP:29.13  kb/s: 28855.09
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>x265 [info]: frame B:  23258, Avg QP:34.69  kb/s: 4505.13
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>x265 [info]: Weighted P-Frames: Y:1.7% UV:1.4%
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>x265 [info]: consecutive B-frames: 1.0% 2.5% 2.3% 91.0% 3.3%
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>encoded 31195 frames in 2677.46s (11.65 fps), 10833.60 kb/s, Avg QP:33.27
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>[aac @ 0x55d67964f4c0] Qavg: 174.559
</span></code></pre></div></p>
<p>设置帧率60fps
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>ffmpeg -i INPUT -c:v libx265 -crf 26 -preset slow -r 60 -c:a aac -b:a 320k OUTPUT
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>frame=31195 fps=8.3 q=36.0 Lsize=  708843kB time=00:08:41.00 bitrate=11145.6kbits/s speed=0.139x
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>video:688054kB audio:20388kB subtitle:0kB other streams:0kB global headers:2kB muxing overhead: 0.056600%
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a>x265 [info]: frame I:    132, Avg QP:27.54  kb/s: 60361.57
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>x265 [info]: frame P:   7805, Avg QP:29.14  kb/s: 28870.71
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>x265 [info]: frame B:  23258, Avg QP:34.70  kb/s: 4507.21
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>x265 [info]: Weighted P-Frames: Y:1.7% UV:1.4%
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>x265 [info]: consecutive B-frames: 1.0% 2.5% 2.3% 91.0% 3.3%
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>encoded 31195 frames in 3751.69s (8.31 fps), 10839.31 kb/s, Avg QP:33.27
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>[aac @ 0x56079a852080] Qavg: 174.559
</span></code></pre></div></p>
<p>src(59.94)   1080p(30)   2160p(59.94)
41.149  40.566  40.539
41.002  41.045  41.045</p>
<p>60         59.94
41.171   41.175
41.023   41.023</p>
<h3 id="av1">av1<a class="headerlink" href="#av1" title="Permanent link">&para;</a></h3>
<p><a href="https://trac.ffmpeg.org/wiki/Encode/AV1">Encode/AV1 – FFmpeg</a></p>
<p>Constant Quality：</p>
<p>libaom-av1 has a constant quality (CQ) mode (like CRF in x264 and x265) which will ensure that <em>every frame gets the number of bits it deserves to achieve a certain (perceptual) quality level</em>, rather than encoding each frame to meet a bit rate target. This results in better overall quality. <strong>If you do not need to achieve a fixed target file size, this should be your method of choice.</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>ffmpeg -i input.mp4 -c:v libaom-av1 -crf 30 -b:v 0 av1_test.mkv
</span></code></pre></div>
<p>慢到不可用！！！</p>
<h2 id="调节帧数">调节帧数<a class="headerlink" href="#调节帧数" title="Permanent link">&para;</a></h2>
<p><a href="https://stackoverflow.com/questions/33749109/best-way-to-convert-a-59-94fps-video-to-29-97">ffmpeg - Best way to convert a 59.94fps video to 29.97? - Stack Overflow</a></p>
<p><a href="https://ffmpeg-user.ffmpeg.narkive.com/VAyCRakI/framerate-conversion-with-sync-audio">[FFmpeg-user] framerate conversion with sync audio (narkive.com)</a>
这位老哥的需求时将24fps的视频转成25fps，要求单纯只是加速，不改变frame内容。由于改变了video的速率，因此也要同时改变audio的速率，最后的结果命令
- 有老哥说-r不是很可靠，建议使用<code>-vf setpts=PTS*0.8</code>
- 还有老哥提议测试以下<code>asetpts</code> filter是否可以
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>ffmpeg -r 25 -i input_24fps.mov -af asetrate=50000,aresample=48000 -c:v  
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>prores -profile:v 3 -c:a pcm_s24le output_25fps_resampledaudio.mov
</span></code></pre></div></p>
<p><a href="https://stackoverflow.com/questions/43333542/what-is-video-timescale-timebase-or-timestamp-in-ffmpeg">What is video timescale, timebase, or timestamp in ffmpeg? - Stack Overflow</a>
- 每frame包含timestamp信息。<strong>P</strong>resentation <strong>T</strong>ime<strong>S</strong>tamps，表示其应该显示的时间？
- For the sake of precise resolution of these time values, a timebase is used。比如1/75为单位
- timescale即timebase的倒数，FFmpeg shows the timescale as the <code>tbn</code> value in the readout of a stream.</p>
<h2 id="gpu硬件加速">GPU硬件加速<a class="headerlink" href="#gpu硬件加速" title="Permanent link">&para;</a></h2>
<p>测试视频：<a href="https://peach.blender.org/download/">Big Buck Bunny » Download (blender.org)</a></p>
<p><strong>强烈推荐</strong>：<a href="https://trac.ffmpeg.org/wiki/Hardware/VAAPI">Hardware/VAAPI – FFmpeg</a></p>
<p>https://wiki.libav.org/Hardware/vaapi</p>
<p>https://www.hardening-consulting.com/en/posts/20170625-using-vaapi-with-ffmpeg.html</p>
<p>查看支持的h264编解码
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a>ffmpeg -codecs|grep 264
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a>DEV.LS h264                 H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10 (decoders: h264 h264_v4l2m2m h264_qsv h264_cuvid ) (encoders: libx264 libx264rgb h264_nvenc h264_omx h264_qsv h264_v4l2m2m h264_vaapi )
</span></code></pre></div></p>
<p>下载h265测试视频
<a href="https://test-videos.co.uk/bigbuckbunny/mp4-h265">MP4 ( H.265 ) | Test Videos (test-videos.co.uk)</a></p>
<h3 id="vaapi测试">vaapi测试<a class="headerlink" href="#vaapi测试" title="Permanent link">&para;</a></h3>
<p>使用vaapi需要以下库
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>apt install va-driver-all mesa-va-drivers
</span></code></pre></div></p>
<p>基本测试，测试权限之类的
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a>ffmpeg -init_hw_device vaapi=va:/dev/dri/renderD128
</span></code></pre></div></p>
<p>调用vaapi加速编码
<div class="language-text highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a>ffmpeg -y -vaapi_device /dev/dri/renderD128 -i Big_Buck_Bunny_1080_10s_30MB.mp4 -vf &#39;format=nv12,hwupload&#39; -c:v h264_vaapi output.mp4
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>ffmpeg -y -i Big_Buck_Bunny_1080_10s_30MB.mp4 -c:v libx264 output.mp4
</span></code></pre></div>
如果设备支持硬件解码
-  hwaccel vaapi指定使用硬件解码
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>ffmpeg -hwaccel vaapi -hwaccel_output_format vaapi -hwaccel_device /dev/dri/renderD128 -i input.mp4 -c:v h264_vaapi output.mp4
</span></code></pre></div></p>
<ul>
<li>n5105 UHD核显，转码big bunny 1080p 30fps, 25Mb/s码率大概50fps</li>
<li>使用cpu转则只有13fps</li>
</ul>
<p>vainfo
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a>error: can&#39;t connect to X server!
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>libva info: VA-API version 1.7.0
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/radeonsi_drv_video.so
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>libva info: Found init function __vaDriverInit_1_7
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>libva info: va_openDriver() returns 0
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>vainfo: VA-API version: 1.7 (libva 2.6.0)
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>vainfo: Driver version: Mesa Gallium driver 21.2.6 for AMD Radeon (TM) R7 M340 (ICELAND, DRM 3.42.0, 5.15.0-86-generic, LLVM 12.0.0)
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>vainfo: Supported profile and entrypoints
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>      VAProfileMPEG2Simple            : VAEntrypointVLD
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>      VAProfileMPEG2Main              : VAEntrypointVLD
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>      VAProfileNone                   : VAEntrypointVideoProc
</span></code></pre></div></p>
<p>n5105
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>root@n5105-pve ➜  test vainfo
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>error: can&#39;t connect to X server!
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a>libva info: VA-API version 1.17.0
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>libva info: Trying to open /usr/lib/x86_64-linux-gnu/dri/iHD_drv_video.so
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>libva info: Found init function __vaDriverInit_1_17
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>libva info: va_openDriver() returns 0
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>vainfo: VA-API version: 1.17 (libva 2.12.0)
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>vainfo: Driver version: Intel iHD driver for Intel(R) Gen Graphics - 23.1.1 ()
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>vainfo: Supported profile and entrypoints
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>      VAProfileNone                   : VAEntrypointVideoProc
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a>      VAProfileNone                   : VAEntrypointStats
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>      VAProfileMPEG2Simple            : VAEntrypointVLD
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a>      VAProfileMPEG2Main              : VAEntrypointVLD
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a>      VAProfileH264Main               : VAEntrypointVLD
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a>      VAProfileH264Main               : VAEntrypointEncSliceLP
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>      VAProfileH264High               : VAEntrypointVLD
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>      VAProfileH264High               : VAEntrypointEncSliceLP
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a>      VAProfileJPEGBaseline           : VAEntrypointVLD
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>      VAProfileJPEGBaseline           : VAEntrypointEncPicture
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a>      VAProfileH264ConstrainedBaseline: VAEntrypointVLD
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>      VAProfileH264ConstrainedBaseline: VAEntrypointEncSliceLP
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a>      VAProfileVP8Version0_3          : VAEntrypointVLD
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>      VAProfileHEVCMain               : VAEntrypointVLD
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a>      VAProfileHEVCMain               : VAEntrypointEncSliceLP
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>      VAProfileHEVCMain10             : VAEntrypointVLD
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a>      VAProfileHEVCMain10             : VAEntrypointEncSliceLP
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a>      VAProfileVP9Profile0            : VAEntrypointVLD
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a>      VAProfileVP9Profile0            : VAEntrypointEncSliceLP
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a>      VAProfileVP9Profile1            : VAEntrypointVLD
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a>      VAProfileVP9Profile1            : VAEntrypointEncSliceLP
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a>      VAProfileVP9Profile2            : VAEntrypointVLD
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a>      VAProfileVP9Profile2            : VAEntrypointEncSliceLP
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>      VAProfileVP9Profile3            : VAEntrypointVLD
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a>      VAProfileVP9Profile3            : VAEntrypointEncSliceLP
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a>      VAProfileHEVCMain422_10         : VAEntrypointVLD
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a>      VAProfileHEVCMain444            : VAEntrypointVLD
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a>      VAProfileHEVCMain444            : VAEntrypointEncSliceLP
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a>      VAProfileHEVCMain444_10         : VAEntrypointVLD
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a>      VAProfileHEVCMain444_10         : VAEntrypointEncSliceLP
</span></code></pre></div></p>
<h2 id="时间戳相关">时间戳相关<a class="headerlink" href="#时间戳相关" title="Permanent link">&para;</a></h2>
<p>DTS解码时间戳
<div class="language-text highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>[matroska @ 0x55a111e20440] Non-monotonous DTS in output stream 0:1; previous: 565, current: 564; changing to 565. This may result in incorrect timestamps in the output file.
</span></code></pre></div></p>
<h3 id="选项">选项<a class="headerlink" href="#选项" title="Permanent link">&para;</a></h3>
<p>-copyts</p>
<p>Do not process input timestamps, but keep their values without trying to sanitize them. In particular, do not remove the initial start time offset value.</p>
<p>Note that, depending on the vsync option or on specific muxer processing (e.g. in case the format option avoid_negative_ts is enabled) the output timestamps may mismatch with the input timestamps even when this option is selected.</p>
<p>-start_at_zero</p>
<p>When used with copyts, shift input timestamps so they start at zero.</p>
<p>This means that using e.g. <code>-ss 50</code> will make output timestamps start at 50 seconds, regardless of what timestamp the input file started at.</p>
<p>-copytb mode</p>
<p>Specify how to set the encoder timebase when stream copying. mode is an integer numeric value, and can assume one of the following values:</p>
<p>1</p>
<p>Use the demuxer timebase.</p>
<p>The time base is copied to the output encoder from the corresponding input demuxer. This is sometimes required to avoid non monotonically increasing timestamps when copying video streams with variable frame rate.</p>
<p>0</p>
<p>Use the decoder timebase.</p>
<p>The time base is copied to the output encoder from the corresponding input decoder.</p>
<p>-1</p>
<p>Try to make the choice automatically, in order to generate a sane output.</p>
<p>Default value is -1.</p>
<h3 id="ffmpeg输出时间戳默认会置为0">ffmpeg输出时间戳默认会置为0<a class="headerlink" href="#ffmpeg输出时间戳默认会置为0" title="Permanent link">&para;</a></h3>
<p><a href="https://stackoverflow.com/questions/51585661/ffmpeg-demux-into-audio-and-video-resets-pts">ffmpeg demux into audio and video resets PTS - Stack Overflow</a>
- ffmpeg分离video时会reset timestamp？</p>
<p>构造一个start为1h的视频
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mp4 -c copy -output_ts_offset 3600 test.mkv
</span></code></pre></div></p>
<p>查看确实start_time = 3600
- 使用mpv播放进度条仍为0
- 使用windows自带的视频播放器，进度条确实从1h开始
- 文件管理器显示的视频时常也确实增加了1h
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Input #0, matroska,webm, from &#39;test.mkv&#39;:
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>  Metadata:
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>    title           : Big Buck Bunny, Sunflower version
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>    GENRE           : Animation
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>    MAJOR_BRAND     : isom
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>    MINOR_VERSION   : 1
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a>    COMPATIBLE_BRANDS: isomavc1
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>    COMPOSER        : Sacha Goedegebure
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>  Duration: 01:10:34.60, start: 3600.000000, bitrate: 497 kb/s
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a>  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>    Metadata:
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>      HANDLER_NAME    : GPAC ISO Video Handler
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>      DURATION        : 01:10:34.600000000
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>    Metadata:
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>      HANDLER_NAME    : GPAC ISO Audio Handler
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>      DURATION        : 01:10:34.144000000
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>start_pts=3600067
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a>start_time=3600.067000
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>start_pts=3600000
</span><span id="__span-44-26"><a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a>start_time=3600.000000
</span></code></pre></div></p>
<p>ffmpeg复制一下
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>ffmpeg -i test.mkv -c copy test_copy.mkv
</span></code></pre></div></p>
<p>确实start被置为0了，即
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>Input #0, matroska,webm, from &#39;test_copy.mkv&#39;:
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>  Metadata:
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    title           : Big Buck Bunny, Sunflower version
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>    GENRE           : Animation
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    MAJOR_BRAND     : isom
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    MINOR_VERSION   : 1
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>    COMPATIBLE_BRANDS: isomavc1
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    COMPOSER        : Sacha Goedegebure
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>  Duration: 00:10:34.60, start: 0.000000, bitrate: 3321 kb/s
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>    Metadata:
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>      HANDLER_NAME    : GPAC ISO Video Handler
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>      DURATION        : 00:10:34.600000000
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a>    Metadata:
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>      HANDLER_NAME    : GPAC ISO Audio Handler
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a>      DURATION        : 00:10:34.144000000
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a>start_pts=67
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>start_time=0.067000
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a>start_pts=0
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a>start_time=0.000000
</span></code></pre></div></p>
<h3 id="ffmpeg合并视频和音频默认居然会有问题">ffmpeg合并视频和音频，默认居然会有问题<a class="headerlink" href="#ffmpeg合并视频和音频默认居然会有问题" title="Permanent link">&para;</a></h3>
<p>将视频分解为视频和音频
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>ffmpeg -i bbb_sunflower_1080p_30fps_normal.mkv -vn -c copy a.m4a -an -c copy a.mkv
</span></code></pre></div></p>
<p>对音频进行截切和偏移（剪掉前1.7s，同时往右偏移1.7s，因此相对于base还是同步的）
<div class="language-text highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>ffmpeg -ss 1.7 -itsoffset 1.7 -i a.m4a -c copy b.m4a
</span></code></pre></div></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a>Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;b.m4a&#39;:
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>  Metadata:
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>    major_brand     : M4A
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    minor_version   : 512
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>    compatible_brands: M4A isomiso2
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>    title           : Big Buck Bunny, Sunflower version
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a>    artist          : Blender Foundation 2008, Janus Bager Kristensen 2013
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>    composer        : Sacha Goedegebure
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a>    encoder         : Lavf58.76.100
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>    comment         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a>    genre           : Animation
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>  Duration: 00:10:34.14, start: 1.696000, bitrate: 319 kb/s
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>  Stream #0:0(und): Audio: ac3 (ac-3 / 0x332D6361), 48000 Hz, 5.1(side), fltp, 320 kb/s (default)
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>    Metadata:
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a>      handler_name    : GPAC ISO Audio Handler
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a>      vendor_id       : [0][0][0][0]
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a>    Side data:
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a>      audio service type: main
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a>start_pts=81408
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a>start_time=1.696000
</span></code></pre></div>
<p>将原本视频和音频合并
<code>ffmpeg -i a.mkv -i b.m4a -c copy merge2.mkv</code>
- ffmpeg直接忽视了input的时间戳，将其认为是从0开始的，然后合并。因此导致声音相比于正确情况提前了。
<div class="language-text highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>Input #0, matroska,webm, from &#39;merge.mkv&#39;:
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>  Metadata:
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>    title           : Big Buck Bunny, Sunflower version
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a>    GENRE           : Animation
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>    MAJOR_BRAND     : isom
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>    MINOR_VERSION   : 1
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a>    COMPATIBLE_BRANDS: isomavc1
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a>    COMPOSER        : Sacha Goedegebure
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>  Duration: 00:10:34.53, start: 0.000000, bitrate: 3321 kb/s
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a>  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a>    Metadata:
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>      HANDLER_NAME    : GPAC ISO Video Handler
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a>      DURATION        : 00:10:34.533000000
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a>    Metadata:
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a>      HANDLER_NAME    : GPAC ISO Audio Handler
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a>      DURATION        : 00:10:32.448000000
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a>start_pts=0
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a>start_time=0.000000
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a>start_pts=0
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#__codelineno-50-26"></a>start_time=0.000000
</span></code></pre></div></p>
<p>正确合并
<code>ffmpeg -i a.mkv -i b.m4a -copyts -c copy merge2.mkv</code>
<div class="language-text highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a>Input #0, matroska,webm, from &#39;merge2.mkv&#39;:
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>  Metadata:
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>    title           : Big Buck Bunny, Sunflower version
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>    ARTIST          : Blender Foundation 2008, Janus Bager Kristensen 2013
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a>    COMMENT         : Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>    GENRE           : Animation
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>    MAJOR_BRAND     : isom
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>    MINOR_VERSION   : 1
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>    COMPATIBLE_BRANDS: isomavc1
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a>    COMPOSER        : Sacha Goedegebure
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>  Duration: 00:10:34.60, start: 0.067000, bitrate: 3320 kb/s
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a>  Stream #0:0: Video: h264 (High), yuv420p(progressive), 1920x1080 [SAR 1:1 DAR 16:9], 30 fps, 30 tbr, 1k tbn, 60 tbc (default)
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a>    Metadata:
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>      HANDLER_NAME    : GPAC ISO Video Handler
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a>      DURATION        : 00:10:34.600000000
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 320 kb/s (default)
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>    Metadata:
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a>      HANDLER_NAME    : GPAC ISO Audio Handler
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a>      DURATION        : 00:10:34.144000000
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>start_pts=67
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a>start_time=0.067000
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a>start_pts=1696
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a>start_time=1.696000
</span></code></pre></div></p>
<h3 id="delay某个流">delay某个流<a class="headerlink" href="#delay某个流" title="Permanent link">&para;</a></h3>
<p>强行将音频delay 0.613s，可以导致不同步
<div class="language-text highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a>(base) fyyuan@icarus4 ➜  reset_pts ffmpeg -i ../src.mkv -itsoffset 0.613 -i ../src.mkv -map 0:0 -map 1:1 -c copy -shortest output_video_adjusted.mkv
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>Input #0, matroska,webm, from &#39;output_video_adjusted.mkv&#39;:
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>  Metadata:
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a>  Duration: 00:08:41.15, start: 0.613000, bitrate: 24908 kb/s
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a>    Metadata:
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>      DURATION        : 00:08:41.149000000
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>    Metadata:
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a>      DURATION        : 00:08:41.018000000
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a>start_pts=613
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>start_time=0.613000
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a>start_pts=613
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a>start_time=0.613000
</span></code></pre></div></p>
<h2 id="b站问题">B站问题<a class="headerlink" href="#b站问题" title="Permanent link">&para;</a></h2>
<h3 id="为什么seek-0638s结果导致video起始变成了41s">为什么seek 0.638s，结果导致video起始变成了4.1s<a class="headerlink" href="#为什么seek-0638s结果导致video起始变成了41s" title="Permanent link">&para;</a></h3>
<p>现象就是视频少了4s，mpv播放时起始直接变成了4s
<div class="language-text highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>Input #0, matroska,webm, from &#39;src.hevc.aac.mkv&#39;:
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>  Metadata:
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>  Duration: 00:08:41.18, start: 0.000000, bitrate: 11146 kb/s
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a>  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>    Metadata:
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>      ENCODER         : Lavc58.134.100 libx265
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>      DURATION        : 00:08:41.175000000
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>  Stream #0:1: Audio: aac (LC), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>    Metadata:
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>      ENCODER         : Lavc58.134.100 aac
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>      DURATION        : 00:08:41.023000000
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>start_pts=638
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>start_time=0.638000
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>start_pts=0
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>start_time=0.000000
</span></code></pre></div></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a>ffmpeg -i src.hevc.aac.mkv -ss 0.638 -c copy cut.hevc.aac.ss638.mkv
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>Input #0, matroska,webm, from &#39;cut.hevc.aac.ss638.mkv&#39;:
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>  Metadata:
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>  Duration: 00:08:40.54, start: 0.002000, bitrate: 10998 kb/s
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a>    Metadata:
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>      ENCODER         : Lavc58.134.100 libx265
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>      DURATION        : 00:08:40.536000000
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a>  Stream #0:1: Audio: aac (LC), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a>    Metadata:
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>      ENCODER         : Lavc58.134.100 aac
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a>      DURATION        : 00:08:40.385000000
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a>start_pts=4171
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>start_time=4.171000
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a>start_pts=2
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a>start_time=0.002000
</span></code></pre></div>
<p>怀疑是seek，seek到下一个关键帧了，导致丢失了关键帧前的所有数据（虽然chatgpt告诉我seek是seek到之前的关键帧）</p>
<h3 id="感觉问题在于为什么自己的视频video和audio-duration相差没那么大而b站转码后就相差05s了">感觉问题在于为什么自己的视频video和audio duration相差没那么大，而B站转码后，就相差0.5s了<a class="headerlink" href="#感觉问题在于为什么自己的视频video和audio-duration相差没那么大而b站转码后就相差05s了" title="Permanent link">&para;</a></h3>
<p>分p版本
源文件
<div class="language-text highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a>Input #0, matroska,webm, from &#39;p09.mkv&#39;:
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>  Metadata:
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>  Duration: 00:08:41.15, start: 0.000000, bitrate: 24909 kb/s
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a>    Metadata:
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>      DURATION        : 00:08:41.149000000
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>    Metadata:
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>      DURATION        : 00:08:41.002000000
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a>start_pts=613
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a>start_time=0.613000
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>start_pts=0
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>start_time=0.000000
</span></code></pre></div></p>
<p>b站下载的
<div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>➜  yt-dlp ./yt-dlp https://www.bilibili.com/video/BV1dG411z7sc -F -I 9
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>[BiliBili] Extracting URL: https://www.bilibili.com/video/BV1dG411z7sc
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>[BiliBili] 1dG411z7sc: Downloading webpage
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>[BiliBili] BV1dG411z7sc: Extracting videos in anthology
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>[BiliBili] Downloading playlist BV1dG411z7sc - add --no-playlist to download just the video BV1dG411z7sc
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a>[download] Downloading playlist: 【第73回NHK紅白歌合戦 BS4K】节选
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>[BiliBili] Playlist 【第73回NHK紅白歌合戦 BS4K】节选: Downloading 1 items
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>[download] Downloading item 1 of 1
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>[BiliBili] Extracting URL: https://www.bilibili.com/video/BV1dG411z7sc?p=9
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>[BiliBili] 1dG411z7sc: Downloading webpage
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>[BiliBili] BV1dG411z7sc: Extracting videos in anthology
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>[BiliBili] 410742370: Extracting chapters
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>[info] Available formats for BV1dG411z7sc_p9:
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a>ID    EXT RESOLUTION FPS │   FILESIZE    TBR PROTO │ VCODEC         VBR ACODEC      ABR
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>───────────────────────────────────────────────────────────────────────────────────────
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a>30216 m4a audio only     │ ≈  2.51MiB    39k https │ audio only         mp4a.40.5   39k
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a>30232 m4a audio only     │ ≈  5.88MiB    92k https │ audio only         mp4a.40.2   92k
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a>30280 m4a audio only     │ ≈  9.87MiB   155k https │ audio only         mp4a.40.2  155k
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a>30016 mp4 640x360     30 │ ≈ 23.35MiB   367k https │ avc1.64001E   367k video only
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a>30032 mp4 852x480     30 │ ≈ 52.44MiB   824k https │ avc1.64001F   824k video only
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a>30064 mp4 1280x720    30 │ ≈116.21MiB  1827k https │ avc1.640028  1827k video only
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a>30080 mp4 1920x1080   30 │ ≈173.36MiB  2725k https │ avc1.640032  2725k video only
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a>30116 mp4 1920x1080   59 │ ≈346.03MiB  5439k https │ avc1.640032  5439k video only
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a>30120 mp4 3840x2160   59 │ ≈  1.16GiB 18644k https │ avc1.640034 18644k video only
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a>[download] Finished downloading playlist: 【第73回NHK紅白歌合戦 BS4K】节选
</span></code></pre></div>
(这里是yt-dlp的bug，需要加copyts，否则合并时会丢弃input timestamp。不过我试了手动merge，貌似仍然不同步，这次变成音频要快一点)
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>Input #0, matroska,webm, from &#39;bili-p09.mkv&#39;:
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>  Metadata:
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>    DESCRIPTION     : Packed by Bilibili XCoder v2.0.2
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>    MAJOR_BRAND     : iso5
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>    MINOR_VERSION   : 1
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>    COMPATIBLE_BRANDS: avc1iso5dsmsmsixdash
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>  Duration: 00:08:41.05, start: 0.000000, bitrate: 18779 kb/s
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    Metadata:
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a>      HANDLER_NAME    : VideoHandler
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>      DURATION        : 00:08:40.539000000
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>  Stream #0:1: Audio: aac (LC), 48000 Hz, stereo, fltp (default)
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>    Metadata:
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>      HANDLER_NAME    : SoundHandler
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>      DURATION        : 00:08:41.045000000
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a>start_pts=0
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a>start_time=0.000000
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a>start_pts=0
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a>start_time=0.000000
</span></code></pre></div>
手动合并的（这里的1.226不就是0.613的两倍吗）（果然，将音频delay +600ms后，就很同步了）
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>Input #0, matroska,webm, from &#39;p9.mkv&#39;:
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>  Metadata:
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>    DESCRIPTION     : Packed by Bilibili XCoder v2.0.2
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>    MAJOR_BRAND     : iso5
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>    MINOR_VERSION   : 1
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    COMPATIBLE_BRANDS: avc1iso5dsmsmsixdash
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>  Duration: 00:08:41.77, start: 0.000000, bitrate: 18753 kb/s
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a>  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>    Metadata:
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a>      HANDLER_NAME    : VideoHandler
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a>      DURATION        : 00:08:41.765000000
</span><span id="__span-59-14"><a id="__codelineno-59-14" name="__codelineno-59-14" href="#__codelineno-59-14"></a>  Stream #0:1: Audio: aac (LC), 48000 Hz, stereo, fltp (default)
</span><span id="__span-59-15"><a id="__codelineno-59-15" name="__codelineno-59-15" href="#__codelineno-59-15"></a>    Metadata:
</span><span id="__span-59-16"><a id="__codelineno-59-16" name="__codelineno-59-16" href="#__codelineno-59-16"></a>      HANDLER_NAME    : SoundHandler
</span><span id="__span-59-17"><a id="__codelineno-59-17" name="__codelineno-59-17" href="#__codelineno-59-17"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-59-18"><a id="__codelineno-59-18" name="__codelineno-59-18" href="#__codelineno-59-18"></a>      DURATION        : 00:08:41.045000000
</span><span id="__span-59-19"><a id="__codelineno-59-19" name="__codelineno-59-19" href="#__codelineno-59-19"></a>start_pts=1226
</span><span id="__span-59-20"><a id="__codelineno-59-20" name="__codelineno-59-20" href="#__codelineno-59-20"></a>start_time=1.226000
</span><span id="__span-59-21"><a id="__codelineno-59-21" name="__codelineno-59-21" href="#__codelineno-59-21"></a>start_pts=0
</span><span id="__span-59-22"><a id="__codelineno-59-22" name="__codelineno-59-22" href="#__codelineno-59-22"></a>start_time=0.000000
</span></code></pre></div></p>
<p>原因在于这里的duration是包含start_pts的，因此源视频的video就比audio少约0.5s</p>
<p>使用setpts（后面发现该命令是filter因此需要转码，速度很慢，实际上对可以input video单独设置input pts offset，后面会用到该命令进行修复），可以复现duration差值变大
<div class="language-text highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a> ffmpeg -i src.mkv -filter_complex &quot;[0:v]setpts=PTS-STARTPTS[v];[0:a]asetpts=PTS-STARTPTS[a]&quot; -map &quot;[v]&quot; -map &quot;[a]&quot; setpts.mkv
</span></code></pre></div></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a>Input #0, matroska,webm, from &#39;setpts.mkv&#39;:
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>  Metadata:
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a>  Duration: 00:08:41.01, start: 0.000000, bitrate: 20558 kb/s
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a>  Stream #0:0: Video: h264 (High 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10, progressive), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    Metadata:
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>      ENCODER         : Lavc58.134.100 libx264
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>      DURATION        : 00:08:40.540000000
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>  Stream #0:1: Audio: vorbis, 48000 Hz, 5.1, fltp (default)
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>    Metadata:
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>      ENCODER         : Lavc58.134.100 libvorbis
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a>      DURATION        : 00:08:41.006000000
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>start_pts=0
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a>start_time=0.000000
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a>start_pts=0
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>start_time=0.000000
</span></code></pre></div>
<h3 id="猜想问题原因">猜想问题原因<a class="headerlink" href="#猜想问题原因" title="Permanent link">&para;</a></h3>
<p>可以看到我上传到B站的文件视频流的起始帧的pts为0.613s，差不多正是B站音画不同步的时间
<div class="language-text highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a>Input #0, matroska,webm, from &#39;src.mkv&#39;:
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>  Metadata:
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>  Duration: 00:08:41.15, start: 0.000000, bitrate: 24909 kb/s
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a>  Stream #0:0: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>    Metadata:
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>      DURATION        : 00:08:41.149000000
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>  Stream #0:1: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>    Metadata:
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>      DURATION        : 00:08:41.002000000
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>start_pts=613
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>start_time=0.613000
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>start_pts=0
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>start_time=0.000000
</span></code></pre></div>
并且经过很多次转码实验，发现转码并不能重置掉这个start_pts，而是基本完全保留
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>src.hevc.aac.60fps.mkv  start_pts=638
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>src.hevc.aac.mkv  start_pts=638
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>src.avc.mkv start_pts=638
</span></code></pre></div></p>
<p>而start_pts的含义便是视频的第一帧应该显示出来的时间。
如果我把这个pts重置为0，视频就会比音频提前（假设原本的pts，音画是同步的话）</p>
<p>而yt-dlp下载B站视频时，视频和音频是分开下载，最后再合并成一个视频的。
我观察了好几个yt-dlp下载的视频，发现start_pts都变成了0。所以猜测：
- <del>B站转码的时候将pts重置为了0（每个frame 做如下filter：<code>[0:v]setpts=PTS-STARTPTS[v]</code>）</del>
- <del>后面发现yt-dlp合并时丢弃了原本的ts，将两个流当作start_pts=0进行合并的。B站的视频和音频文件是有offset</del>
- <del>但是即使手动-copyts合并，仍然不同步，并且这次变成音频提前了。</del>
UDPATE: 是yt-dlp会清除timestamps。不过这里的问题在于B站好像也忽略了时间戳，导致不同步</p>
<p>至于为什么一开始使用-ss剪辑出8分钟的片段时，pts为613而不是干脆置为0。<strong>怀疑流复制情况，只能seek到pos之后的一个关键帧</strong>（而不是chatgpt告诉我的seek到之前的关键帧）</p>
<h3 id="其它">其它<a class="headerlink" href="#其它" title="Permanent link">&para;</a></h3>
<h4 id="发现原始视频有两个audio">发现原始视频有两个audio<a class="headerlink" href="#发现原始视频有两个audio" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a>Input #0, mpegts, from &#39;2022-12-31 第73回NHK 紅白歌合戦 NHK BS4K.m2ts&#39;:
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>  Duration: 04:25:01.42, start: 61.462067, bitrate: 26406 kb/s
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>  Program 101
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>  Stream #0:0[0x1011]: Video: hevc (Main 10) (HESE / 0x45534548), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 90k tbn, 59.94 tbc
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>  Stream #0:1[0x1100]: Audio: aac_latm (LC) ([17][0][0][0] / 0x0011), 48000 Hz, stereo, fltp
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>  Stream #0:2[0x1c00]: Data: bin_data ([6][0][0][0] / 0x0006)
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a>  Stream #0:3[0x1c01]: Data: bin_data ([6][0][0][0] / 0x0006)
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>  Stream #0:4[0x1101]: Audio: aac_latm (LC) ([17][0][0][0] / 0x0011), 48000 Hz, stereo, fltp
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a>Unsupported codec with id 100359 for input stream 2
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a>Unsupported codec with id 100359 for input stream 3
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>start_pts=5577842
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>start_time=61.976022
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a>start_pts=5531586
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>start_time=61.462067
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>start_pts=5531586
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>start_time=61.462067
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>start_pts=5531586
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a>start_time=61.462067
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>start_pts=5589186
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>start_time=62.102067
</span></code></pre></div>
<h4 id="youtube没问题">youtube没问题<a class="headerlink" href="#youtube没问题" title="Permanent link">&para;</a></h4>
<p>yt-dlp合并视频和音频时，究竟是如何对准ts的？
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>Input #0, mpegts, from &#39;youtube.f312.mp4&#39;:
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>  Duration: 00:08:41.15, start: 0.016678, bitrate: 5441 kb/s
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>  Program 1
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>  Stream #0:0[0x100]: Video: h264 (High) ([27][0][0][0] / 0x001B), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 90k tbn, 119.88 tbc
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>start_pts=1501
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>start_time=0.016678
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>Input #0, mov,mp4,m4a,3gp,3g2,mj2, from &#39;youtube.f380.m4a&#39;:
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>  Metadata:
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>    major_brand     : dash
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>    minor_version   : 0
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>    compatible_brands: iso6mp41
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>    creation_time   : 2024-01-02T23:44:20.000000Z
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a>  Duration: 00:08:41.15, start: 0.000000, bitrate: 384 kb/s
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>  Stream #0:0(und): Audio: ac3 (ac-3 / 0x332D6361), 48000 Hz, 5.1(side), fltp, 384 kb/s (default)
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a>    Metadata:
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a>      creation_time   : 2024-01-02T23:44:20.000000Z
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>      handler_name    : ISO Media file produced by Google Inc.
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a>      vendor_id       : [0][0][0][0]
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a>    Side data:
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a>      audio service type: main
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a>start_pts=0
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>start_time=0.000000
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>Input #0, matroska,webm, from &#39;youtube.mkv&#39;:
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a>  Metadata:
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>  Duration: 00:08:41.15, start: 0.000000, bitrate: 5661 kb/s
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a>  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a>    Metadata:
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a>      DURATION        : 00:08:41.154000000
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 384 kb/s (default)
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a>    Metadata:
</span><span id="__span-65-34"><a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a>      HANDLER_NAME    : ISO Media file produced by Google Inc.
</span><span id="__span-65-35"><a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-65-36"><a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>      DURATION        : 00:08:41.152000000
</span><span id="__span-65-37"><a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a>start_pts=0
</span><span id="__span-65-38"><a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a>start_time=0.000000
</span><span id="__span-65-39"><a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a>start_pts=0
</span><span id="__span-65-40"><a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>start_time=0.000000
</span></code></pre></div></p>
<p>手动merge + -copyts
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>Input #0, matroska,webm, from &#39;youtube-hand-merge2.mkv&#39;:
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>  Metadata:
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>  Duration: 00:08:41.17, start: 0.000000, bitrate: 5661 kb/s
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>  Stream #0:0: Video: h264 (High), yuv420p(tv, bt709, progressive), 1920x1080 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 119.88 tbc (default)
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>    Metadata:
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>      DURATION        : 00:08:41.171000000
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>  Stream #0:1: Audio: ac3, 48000 Hz, 5.1(side), fltp, 384 kb/s (default)
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>    Metadata:
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>      HANDLER_NAME    : ISO Media file produced by Google Inc.
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>      VENDOR_ID       : [0][0][0][0]
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>      DURATION        : 00:08:41.152000000
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>start_pts=17
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>start_time=0.017000
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>start_pts=0
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>start_time=0.000000
</span></code></pre></div></p>
<h3 id="设置输入和输出pts">设置输入和输出pts<a class="headerlink" href="#设置输入和输出pts" title="Permanent link">&para;</a></h3>
<p>尝试cut + reset offset
- 重点在于-itsoffset是对输入的文件的所有流加上一个偏移
- 而output则是对输出的再加上个偏移
<div class="language-text highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a>ffmpeg -vn -ss 0.613 -itsoffset 0.613 -i ../src.mkv -an -i ../src.mkv -c copy -map 0:a -map 1:v -output_ts_offset -0.613 output_combined.mkv
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>Input #0, matroska,webm, from &#39;output_combined.mkv&#39;:
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>  Metadata:
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>    ENCODER         : Lavf58.76.100
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>  Duration: 00:08:40.59, start: 0.000000, bitrate: 24935 kb/s
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>  Stream #0:0: Audio: aac_latm (LC) ([2][22][0][0] / 0x1602), 48000 Hz, 5.1, fltp (default)
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>    Metadata:
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>      DURATION        : 00:08:40.438000000
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>  Stream #0:1: Video: hevc (Main 10), yuv420p10le(tv, bt2020nc/bt2020/bt2020-10), 3840x2160 [SAR 1:1 DAR 16:9], 59.94 fps, 59.94 tbr, 1k tbn, 59.94 tbc (default)
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>    Metadata:
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>      DURATION        : 00:08:40.585000000
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a>start_pts=55
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a>start_time=0.055000
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a>start_pts=0
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a>start_time=0.000000
</span></code></pre></div></p>
<p>文件duration的不可靠，是包含了start_pts的
- <strong>这解释了为什么从B站下载的文件，start_pts变0后，为什么duration相差很大</strong>
- 相当于stream和文件duration，duration都是计算最长的？</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
          
          <a href="../../../../../%E6%8A%98%E8%85%BE/2022/05/24/2022-05-24-%E4%BD%BF%E7%94%A8docker%E9%85%8D%E7%BD%AEhexo%E5%8D%9A%E5%AE%A2%E7%8E%AF%E5%A2%83/" class="md-footer__link md-footer__link--prev" aria-label="上一页: 使用docker配置hexo博客环境">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
              <div class="md-ellipsis">
                使用docker配置hexo博客环境
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../../../%E5%8D%9A%E5%AE%A2/2022/07/01/2022-07-01-%E5%AE%9E%E9%AA%8C%E5%AE%A4%E7%BD%91%E7%BB%9C%E9%A3%8E%E6%B3%A2/" class="md-footer__link md-footer__link--next" aria-label="下一页: 实验室网络风波">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
              <div class="md-ellipsis">
                实验室网络风波
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/TheRainstorm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.footer", "content.code.copy", "toc.follow", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>